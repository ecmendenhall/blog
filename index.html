
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Connor Mendenhall</title>
	<meta name="author" content="Connor Mendenhall">

	
	<meta name="description" content="Sep 2nd, 2013 Clojure, clean code Clean Clojure: Meaningful Names I came to 8th Light for a chance to write Clojure, and in the last few
weeks, the &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/blog/atom.xml" rel="alternate" title="Connor Mendenhall" type="application/atom+xml">
	
	<link rel="canonical" href="http://ecmendenhall.github.io/blog/">
	<link href="/blog/favicon.png" rel="shortcut icon">
	<link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/blog/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("ecmendenhall@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1><a href="/blog/">Connor Mendenhall</a></h1>
  
</hgroup>

<p class="subtitle"></p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/ecmendenhall" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/ecmendenhall" title="GitHub">GitHub</a>
		
		
		
		
		
		
		<a class="pinboard" href="https://pinboard.in/u:ecmendenhall" title="Pinboard">Pinboard</a>
		
		
		<a class="rss" href="/blog/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-09-02T22:35:00-05:00" data-updated="true" itemprop="datePublished">Sep 2<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/clojure/'>Clojure</a>, <a class='category' href='/blog/categories/clean-code/'>clean code</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/blog/2013/09/02/clean-clojure-meaningful-names/" itemprop="url">Clean Clojure: Meaningful Names</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I came to 8th Light for a chance to write Clojure, and in the last few
weeks, the lofty dream of slinging s-expressions during my day job
has finally come true. (Apprentices are compensated at a flat rate of
$0.002 per parenthesis). After spending three months learning rules
and practices for writing clean object-oriented code, I&#8217;m now
<a href="https://leanpub.com/fp-oo">mapping them to functional programming</a>.
Over the next few posts, I&#8217;ll try translating some of the guidelines
for clean code to Clojure. Like <a href="https://chronicle.com/article/50-Years-of-Stupid-Grammar/25497">any style guide</a>, there will be room
for opinion, so don&#8217;t hesitate to leave comments or offer suggestions.</p>

<p><a href="https://chronicle.com/article/50-Years-of-Stupid-Grammar/25497"><em>Clean Code</em></a> is worth the cover price for Chapter 2 alone. Its
advice is simple: use meaningful, clear names that reveal intent.
This rule probably seems obvious, but the value is in its side
effects. Taking the time to scrutinize every name requires
the sort of mindfulness and thought that produces clean code. In
addition to Uncle Bob&#8217;s general guidelines for good names, here are a
few Clojure-specific rules on naming.</p>

<h2>Verbs rule</h2>

<p>Clojure&#8217;s categorical imperative: act in the <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">Kingdom of
Verbs</a>.
Functions do things, and their names should describe the things they
do. This is usually an easy rule to follow, but functions that build
or return data structures can be tricky. <code>Make-user-map</code> is better
than <code>user-data</code>. <code>Render-footer</code> is better than <code>footer</code> alone.</p>

<h2>But nouns are useful</h2>

<p>Verbs are great, but they&#8217;re even greater when they have objects. A name like
<code>remove-temporary-files</code> is much clearer than <code>clean-up</code>.</p>

<p>Nouns are also useful inside functions. I find my tolerance for
repetition far lower in Clojure than in other languages: if I use an expression more
than once, I&#8217;ll almost always put it in a <code>let</code> binding and give it a
name. Inside functions that compose multiple transformations on some
data structure, extracting intermediate steps into values in a <code>let</code>
binding can be very helpful.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">make-french-wombat-pairs</span> <span class="p">[</span><span class="nv">crazy-nested-map</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">interesting-pairs</span>  <span class="p">(</span><span class="nf">extract-interesting-pairs</span> <span class="nv">crazy-nested-map</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">pairs-with-wombats</span> <span class="p">(</span><span class="nb">map </span><span class="nv">add-wombat</span> <span class="nv">interesting-pairs</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">in-french</span>          <span class="p">(</span><span class="nb">map </span><span class="nv">to-french</span> <span class="nv">pairs-with-wombats</span><span class="p">)]</span>
</span><span class='line'>    <span class="nv">in-french</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Good nouns are also helpful when destructuring
values, which is awesomely useful but sometimes hard to read. Prefer
putting them in <code>let</code> bindings to cramming them in the argument list,
except for very simple cases.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">print-summary</span> <span class="p">[</span><span class="nv">statistics</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[{</span><span class="nv">raw-data</span> <span class="ss">:data</span> <span class="p">{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">mean</span> <span class="nv">variance</span> <span class="nv">r-squared</span><span class="p">]}</span> <span class="ss">:summary</span><span class="p">}</span> <span class="nv">statistics</span><span class="p">]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Mean: &quot;</span> <span class="nv">mean</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Variance: &quot;</span> <span class="nv">variance</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">println </span><span class="s">&quot;R-Squared: &quot;</span> <span class="nv">r-squared</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Sample size: &quot;</span> <span class="p">(</span><span class="nb">count </span><span class="nv">raw-data</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">arctic-circle?</span> <span class="p">[[</span><span class="nv">latitude</span> <span class="nv">_</span><span class="p">]]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">&gt; </span><span class="nv">latitude</span> <span class="mi">65</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>And okay fine, also adjectives</h2>

<p>The one first-class exception to verbs everywhere is adjectives for
predicates (functions that return <code>true</code> or <code>false</code>, like <code>odd?</code> and
<code>seq?</code>). These should always end in question marks and always return
either <code>true</code> or <code>false</code>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">all-wombats?</span> <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">every? </span><span class="p">(</span><span class="nf">wombat?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Use the best name&#8230;</h2>

<p>Clojure has a large set of core functions, and sometimes the clearest
name for a function will collide with one of them. Use it anyways!
This is why namespaces are useful. Similarly, don&#8217;t worry if the best
name is a long one&#8211;it&#8217;s easy to rebind it to a new name when required.</p>

<h2>&#8230;But don&#8217;t mislead</h2>

<p>That said, make sure it really is the best name. Long names often
indicate functions that can be split: <code>invert-and-multiply</code> and
<code>find-and-replace</code> should probably be split in two. (Hint: <code>and</code> is a
great clue). If a function&#8217;s name collides with a core function or
incorporates a common name, it should act the same way: if <code>table-map</code>
doesn&#8217;t apply a function to every cell in a table, it has the wrong name.</p>

<h2>Use idiomatic vocabulary</h2>

<p>The <a href="https://github.com/bbatsov/clojure-style-guide">Clojure style guide</a>, <a href="http://clojuredocs.org/">Clojuredocs examples</a> and Clojure&#8217;s own
<a href="http://dev.clojure.org/display/community/Library+Coding+Standards">library coding
standards</a>
are good resources for picking up common Clojure idioms and
vocabulary. Here are a few naming conventions.</p>

<p>In macros, <code>expr</code> is usually used for a single expression and <code>body</code>
for a longer form.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nb">when </span><span class="p">[</span><span class="nv">expr</span> <span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
</span><span class='line'>  <span class="o">`</span><span class="p">(</span><span class="k">if </span><span class="o">~</span><span class="nv">expr</span> <span class="p">(</span><span class="k">do </span><span class="o">~@</span><span class="nv">body</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>&#8220;Collection&#8221; is often shortened to <code>coll</code>:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">remove-wombats</span> <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">filter </span><span class="nv">wombat?</span> <span class="nv">coll</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bundling up extra arguments is almost always done with <code>&amp; more</code>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">shout-all-args</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">more</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nv">arg</span> <span class="nv">more</span><span class="p">]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">upcase</span> <span class="nv">arg</span><span class="p">)</span> <span class="s">&quot;!&quot;</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Like in middle school math, <code>n</code> is usually an integer, <code>x</code> and <code>y</code> are
default numerical inputs, and <code>f</code>, <code>g</code>, and <code>h</code> are often functions.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">local-max?</span> <span class="p">[</span><span class="nv">f</span> <span class="p">[</span><span class="nv">x</span> <span class="nv">y</span><span class="p">]]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">f</span><span class="o">&#39;</span>  <span class="p">(</span><span class="nf">derivative</span> <span class="nv">f</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">f</span><span class="o">&#39;&#39;</span> <span class="p">(</span><span class="nf">derivative</span> <span class="p">(</span><span class="nf">derivative</span> <span class="nv">f</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&lt; </span><span class="mi">0</span> <span class="p">(</span><span class="nf">f</span><span class="o">&#39;&#39;</span> <span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="p">(</span><span class="nf">f</span><span class="o">&#39;</span> <span class="nv">x</span><span class="p">))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Dynamic vars wear <code>*earmuffs*</code>. Try not to use them.</p>

<p>Simple format transformations often use an arrow, e.g.: <code>cljs-&gt;clj</code>,
<code>html-&gt;hiccup</code>, <code>hex-&gt;bytes</code>.</p>

<h2>Make side effects explicit</h2>

<p>Clojure does a great job separating <a href="http://www.infoq.com/presentations/Value-Identity-State-Rich-Hickey">value, state, and
  identity</a>.
  Clojure programmers should, too. If a function changes state or has
  side effects, its name should reflect it. Functions that mutate
  state like <code>swap!</code> and <code>reset!</code> end with a bang. Side effects hiding
  elsewhere should also be explicit: if <code>format-page</code> saves a file to
  disk, it should be <code>format-and-save-page</code> (or even better, two
  separate functions).</p>

<p><strong>UPDATE</strong>: See also the <a href="https://github.com/bbatsov/clojure-style-guide">Clojure Style Guide</a>, a concise, comprehensive community-driven document with many more guidelines on clean Clojure.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-08-25T22:25:00-05:00" data-updated="true" itemprop="datePublished">Aug 25<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/tdd/'>TDD</a>, <a class='category' href='/blog/categories/open-source/'>open source</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/blog/2013/08/25/its-called-software-for-a-reason/" itemprop="url">It&#8217;s Called Software for a Reason</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Although my Github projects have always included <a href="http://vimeo.com/71984135">open source
licenses</a>, I haven&#8217;t made many
contributions to projects people actually use &#8211; at least until this week, when I submitted my first real <a href="https://help.github.com/articles/using-pull-requests">pull requests</a>. After learning a little Java from my Tic-Tac-Toe and server project, I managed to close an issue I opened six months ago on <a href="http://clojurememcached.info/">Spyglass</a>. And I&#8217;ve spent most of this weekend hacking in Ruby on <a href="http://exercism.io/">Exercism.io</a>, a code koan site that focuses on expressive, readable code.</p>

<p>Not long ago, most software seemed static and untouchable: I treated the libraries and tools I used as artifacts of &#8220;real programmers&#8221; imbued with a <a href="http://www.marxists.org/reference/subject/philosophy/works/ge/benjamin.htm">special aura</a>. Slowly, over the last few months, that category has dissolved. Most of the code I touch is no doubt still written by people smarter than me, but suddenly it seems malleable and open for extension.</p>

<p>This, I think, is an underrated benefit of test-driven code. Even when
I still feel like I&#8217;m faking it, I have tests that tell the truth: the
code works as intended. But for learning to test, I don&#8217;t think I&#8217;d
have developed the confidence to jump into an established project and
commit without fear. Writing docs and working from open issues are a
good start, but to really contribute, the first step is writing tests.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-08-14T08:10:00-05:00" data-updated="true" itemprop="datePublished">Aug 14<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/agile/'>agile</a>, <a class='category' href='/blog/categories/efficiency/'>efficiency</a>, <a class='category' href='/blog/categories/productivity/'>productivity</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/blog/2013/08/14/seen-and-unseen-value/" itemprop="url">Seen and Unseen Value</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>The idea at the heart of agile development is really very simple: many
incremental, functional improvements create more value than one big,
centralized push. At 8th Light, we demo completed features to our
clients at the end of each weekly iteration. It&#8217;s a chance to show
clients that we&#8217;re making progress and creating tangible value.
Perhaps more important, it shortens the feedback loop between feature
ideas and implementation.</p>

<p>A good user story creates &#8220;business value.&#8221; But note the &#8220;business.&#8221;
There are many story-like tasks that create lots of value for
developers. Refactoring crufty code into something more stable and
extensible always extends its lifespan. Speeding up the test
suite might mean writing twice as fast. A new design pattern or
library behind the scenes can eliminate scores of future headaches.
And yet none of these improvements are visible, and none really create
business value. They all have second-order effects on business value,
usually on scales longer than one week, but the immediate effects are invisible.</p>

<p>It&#8217;s easy to spend a whole week on pseudostories with nothing visible
to show. (I&#8217;ve certainly done it!) And it&#8217;s easy to feel resentful
when lots of work looks like nothing new at all. But consider a
client&#8217;s perspective and invisible efficiencies start to look pretty
lame: imagine a carpenter showing off her rad new nailgun (<em>twice</em> as
fast as a hammer!) instead of the house she&#8217;s supposed to be building.</p>

<p>Unseen improvements are hugely helpful, but they don&#8217;t count if they
aren&#8217;t visible. That doesn&#8217;t mean they can&#8217;t be made to count.
It can require creativity, but it&#8217;s possible to make unseen
improvements more obvious&#8211;show, don&#8217;t tell, as the writer&#8217;s adage
goes. Show how using a repository makes it easy to swap in new data sources.
Show the new views that reuse carefully extracted components. Show a
new feature that Clojurescript made possible. Setting visible goals
along the way makes unseen value clear.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-08-04T15:20:00-05:00" data-updated="true" itemprop="datePublished">Aug 4<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/gmail/'>Gmail</a>, <a class='category' href='/blog/categories/os-x/'>OS X</a>, <a class='category' href='/blog/categories/ruby/'>Ruby</a>, <a class='category' href='/blog/categories/privacy/'>privacy</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/blog/2013/08/04/diy-gmail-with-sup/" itemprop="url">DIY Gmail With Sup</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I&#8217;ve been a Gmail user for my entire adult life. Ever since I
abandoned my old AOL inbox on the family PC, Gmail has simply <em>been</em>
email. I&#8217;ve never used folders, only labels. I&#8217;ve never deleted
old messages to save space, but archived everything. I&#8217;ve always
expected full-text search, aggressive spam filtering, and continuous
access from any device.</p>

<p>As I&#8217;ve archived year after year of new messages, I&#8217;ve become less
comfortable storing my entire indexed email history on someone else&#8217;s
servers, where they can be scanned and
<a href="https://ssd.eff.org/3rdparties/govt/stronger-protection">searched</a> at
will. And yet in practice , I&#8217;ve always traded off privacy against
<a href="https://www.youtube.com/watch?v=dBtmzY5gcO8">convention</a> and
<a href="https://www.schneier.com/blog/archives/2013/06/trading_privacy_1.html">convenience</a>.</p>

<p>In part, this is because it&#8217;s long been a discontinuous decision: even a
small amount of extra control or privacy required giving up all the
modern conveniences of webmail at once. No desktop client came close to the features of Gmail, so I never made the switch. But now that
I spend most of my time in a terminal, I&#8217;ve finally found a client
that provides a pretty good compromise: <a href="http://supmua.org/">sup</a>.</p>

<p>Sup is not something I&#8217;d set up for my Mom, but Rubyists and Unix
geeks will feel right at home. It&#8217;s a
<a href="https://en.wikipedia.org/wiki/Curses_(programming_library)">curses</a>
based mail client written in Ruby with excellent full text search out
of the box. In addition to offering archiving, labels, and search,
it&#8217;s built on top of extensible tools like offlineimap, msmtp, and gpg, and
scriptable in Ruby.</p>

<p>The official docs are very good (and thus don&#8217;t need to be repeated),
but these are the sections I found most helpful in order:</p>

<ul>
<li><a href="https://github.com/sup-heliotrope/sup/wiki/Mac-OSX">OS X
installation</a></li>
<li><a href="https://github.com/sup-heliotrope/sup/wiki/Mac-OSX">Gmail
configuration</a></li>
<li><a href="https://github.com/sup-heliotrope/sup/wiki/Adding-sources">Storing messages in Maildirs</a></li>
<li><a href="https://github.com/sup-heliotrope/sup/wiki/Securely-Store-Password">Secure password
storage</a></li>
<li><a href="https://github.com/sup-heliotrope/sup/wiki/gpg">GPG integration</a></li>
</ul>


<p>For now, sup doesn&#8217;t do two-way IMAP syncing, so messages I archive
stay on my machine. In my case this is a feature, not a bug: I now
have a permanent searchable archive stored locally that won&#8217;t change
if I delete messages from my Gmail account. I can keep the last few
weeks of mail on the Gmail server, accessible from my phone and the web (and seriously, when
was the last time you looked at an email more than a month old?), and
everything else securely archived on my own drive.</p>

<p>It would be a mistake to consider my sup setup much more private than
plain Gmail. My messages still travel across the internet in cleartext and pile up
in my correspondents&#8217; inboxes. (Sup integrates nicely with GPG for
ad hoc encryption). They&#8217;re probably still stored in <a href="https://www.quora.com/Gmail/Does-gmail-delete-the-deleted-emails-forever">Google
backups</a>
and no doubt snarfed and <a href="http://www.wired.com/threatlevel/2012/03/ff_nsadatacenter/">sent off to
Bluffdale</a>.
I am probably not paranoid enough, but I believe Google&#8217;s claims that they really do erase deleted
messages, and keeping my own archive raises the cost of compromising
or reconstructing my entire history by a little bit, without
sacrificing the features I&#8217;ve become so dependent upon.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-08-04T14:19:00-05:00" data-updated="true" itemprop="datePublished">Aug 4<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/clojure/'>Clojure</a>, <a class='category' href='/blog/categories/clojurescript/'>ClojureScript</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/blog/2013/08/04/specljs-leiningen-template/" itemprop="url">Specljs Leiningen Template</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I&#8217;m very fond of <a href="http://speclj.com/">Speclj</a>, the simple, flexible Clojure spec runner we
use at 8th Light. Speclj now has a ClojureScript
<a href="https://clojars.org/specljs">counterpart</a>, but like many things
ClojureScript, it requires some classpath juggling and configuration
to get everything working nicely. To save my future self the hassle, I
put together a basic project template with Speclj and Specljs tests
and autorunners both preconfigured.</p>

<p>If you&#8217;re using Leiningen 2, it&#8217;s as easy as:</p>

<pre><code>$ lein new specljs &lt;your project name&gt;
</code></pre>

<p>Leiningen will download the template from Clojars automatically.</p>

<p>To start the Speclj autorunner from inside the project directory:</p>

<pre><code>$ lein spec -a
</code></pre>

<p>Specljs tests are configured to run whenever the ClojureScript
compiles. To watch for changes, rebuild and run tests automatically,
start the cljsbuild auto-compiler:</p>

<pre><code>$ lein cljsbuild auto
</code></pre>

<p>To run specljs tests once:</p>

<pre><code>$ lein cljsbuild test
</code></pre>

<p>If you&#8217;re using pre-2.0 Leiningen, you can find the template on
<a href="https://clojars.org/specljs/lein-template">Clojars</a> and the source on <a href="https://github.com/ecmendenhall/specljs-template">GitHub</a>.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-07-30T00:08:00-05:00" data-updated="true" itemprop="datePublished">Jul 30<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/free-software/'>Free software</a>, <a class='category' href='/blog/categories/security/'>Security</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/blog/2013/07/30/open-web-security-essentials/" itemprop="url">Open Web Security Essentials</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Over the past two weeks, I&#8217;ve been working through <a href="http://www.amazon.com/The-Web-Application-Hackers-Handbook/dp/1118026470">The Web Application
Hacker&#8217;s
Handbook</a>.
Although it&#8217;s not part of the 8th Light core curriculum, it ought to
be: it&#8217;s a comprehensive catalog of web security mistakes and a great
introduction to thinking about vulnerabilities from an attacker&#8217;s perspective. The only gripe I have
with the authors is their penchant for plugging expensive closed-source software
and online training. Fortunately, I&#8217;ve found plenty of free
alternatives. Here are a few of the essential tools I&#8217;ve found for
developers interested in web security.</p>

<h2>VirtualBox</h2>

<p>Every tool in my pentesting kit depends on
<a href="https://www.virtualbox.org/">VirtualBox</a>. Working in virtual machines
keeps my security tools separate from my development environment, and
allows me to practice attacking hideously vulnerable applications in
quarantine. VirtualBox includes excellent network configuration
options, including completely virtualized local networks that make it
easy to keep things compartmentalized.</p>

<h2>Kali Linux</h2>

<p><a href="http://www.kali.org/">Kali Linux</a>, formerly BackTrack, is a
specialized Debian distribution that includes hundreds of built in
security tools. I can&#8217;t begin to imagine the time I might have spent
with Homebrew installing and configuring everything included here. The tools included with Kali are many and powerful, and
I&#8217;ve discovered a new fuzzer, proxy, or scanner to try for every topic
in the book.</p>

<h2>Zed Attack Proxy</h2>

<p>The authors of WAHH frequently plug their own Burp Suite, a closed-source
intercepting proxy that costs $300 per user per year to do anything
useful. <a href="https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project">Zed Attack
Proxy</a>,
developed by the <a href="https://www.owasp.org/index.php/Main_Page">Open Web Security
Project</a>, is completely free, Apache
licensed, and just as good an educational and testing tool.
(It&#8217;s included in Kali, along with the free
edition of Burp). Hacking tools are not always the most carefully
crafted software, but ZAP is an extremely stable, very pleasant
exception. <a href="https://www.owasp.org/index.php/WebScarab_Getting_Started">WebScarab</a>, also by OWASP, is another good free alternative.</p>

<h2>SQLMap</h2>

<p>I remember the joy of my first successful SQL injection like it was
last Thursday. (It <em>was</em> last Thursday, but that&#8217;s beside the point).
The thrill of breaking in with a well placed apostrophe and couple of
dashes takes a while to wear off, but diminishing returns are likely to
set in after 50 handcrafted variations on the same GET parameter.
Fortunately, there&#8217;s
<a href="https://github.com/sqlmapproject/sqlmap">SQLMap</a>, which almost makes
it too easy, automating the entire process of finding and exploiting SQL injection vulnerabilities.</p>

<p>All these tools are no fun without something to (safely, responsibly, legally)
attack. Browsing through WAHH, I was excited to see lots of links to
online interactive labs illustrating almost every concept. I was less
excited to discover that they&#8217;re completely proprietary and cost
$7/hour. Fortunately, there are plenty of open alternatives:</p>

<h2>Metasploitable</h2>

<p><a href="http://sourceforge.net/projects/metasploitable/files/Metasploitable2/">Metasploitable2</a>
is an intentionally vulnerable virtual machine configured to run
several vulnerable web applications on port 80 by default, including
<a href="http://www.dvwa.co.uk/">Damn Vulnerable Web App</a> and
<a href="https://www.owasp.org/index.php/OWASP_Mutillidae_2_Project">Mutillidae</a>.
Before booting it up, please make sure your network settings are
<a href="https://www.youtube.com/watch?v=e0vpBKRZPGc">configured
correctly</a>: it should
never ever be exposed to users on your network or the internet.</p>

<h2>RailsGoat</h2>

<p>I&#8217;m not reading WAHH to become a professional pentester. I&#8217;m doing it
to learn how to develop safe web applications, and we write lots of
them in Rails. <a href="https://github.com/OWASP/railsgoat">RailsGoat</a> (yet
another OWASP project) is a vulnerable Rails application with built-in
documentation and examples of the <a href="https://www.owasp.org/index.php/Top_10_2013-Top_10">top
10</a> web
vulnerabilities. Best of all, each one includes code samples, which
are especially useful for a developer like me trying to avoid writing
a goat of my own.</p>

<h2>OWASP</h2>

<p>Many of these resources come courtesy of OWASP, the <a href="https://www.owasp.org/index.php/Main_Page">Open Web
Application Security
Project</a>. In addition to
developing lots of free tools, they&#8217;re an excellent resource for
learning about web security.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-07-15T00:31:00-05:00" data-updated="true" itemprop="datePublished">Jul 15<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/clojure/'>Clojure</a>, <a class='category' href='/blog/categories/core-dot-logic/'>core.logic</a>, <a class='category' href='/blog/categories/logic-programming/'>logic programming</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/blog/2013/07/15/prime-factorization-with-core-dot-logic/" itemprop="url">Prime Factorization With core.logic</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>It&#8217;s time for my first <a href="http://blog.8thlight.com/micah-martin/2013/05/28/performing-code-katas.html">code
kata</a>,
and on Colin&#8217;s suggestion, I&#8217;m starting with a classic: <a href="http://butunclebob.com/ArticleS.UncleBob.ThePrimeFactorsKata">prime
factorization</a>.
The problem description is simple: write a function that takes an
integer n and returns a list of its prime factors in ascending order.
That leaves lots of room for creativity, and in my few months at 8th
Light, I&#8217;ve seen several interesting solutions, including <a href="https://github.com/marosluuce/objective-c-PrimeFactors">Objective-C</a>
and
<a href="http://telladifferentstory.tumblr.com/post/49745640314/pattern-matching-re-visited-with-the-prime-factors-kata">Erlang</a>.
I&#8217;ve been meaning to learn Clojure&#8217;s <code>core.logic</code> library for a while,
so I decided to come up with a logic programming solution.</p>

<p>If you haven&#8217;t yet checked out <code>core.logic</code>, there are a growing
number of resources on the web. To get up to speed, I worked through David Nolen&#8217;s <a href="https://github.com/swannodette/logic-tutorial">logic tutorial</a>, the <a href="http://objectcommando.com/blog/2011/11/04/the-magical-island-of-kanren-core-logic-intro-part-1/">Magical Island of Kanren</a>, the
<a href="https://github.com/clojure/core.logic/wiki/A-Core.logic-Primer">core.logic
Primer</a>,
and a few chapters of <a href="http://www.amazon.com/The-Reasoned-Schemer-Daniel-Friedman/dp/0262562146">The Reasoned
Schemer</a>.
Hopefully, following along with my test cases will explain the subset
of logic functions in my solution.</p>

<p>I&#8217;ll start with a basic <a href="https://github.com/slagyr/speclj">speclj</a>
test setup:</p>

<figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>For the production code, I&#8217;ll start with <code>core.logic</code> and three functions from the <a href="https://github.com/clojure/core.logic/wiki/Features#clpfd">finite domain</a> namespace.</p>

<figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>On to the tests! The declarative aspect of logic programming feels
well-suited to a mathy problem like this. Instead of describing <em>how</em> to
factorize, I&#8217;ll write a few definitions and let the logic engine
handle the rest. The strategy I have in mind is the same simple one I learned in
8th grade algebra: start with a composite integer, and <a href="https://en.wikipedia.org/wiki/Prime_factorization#Prime_decomposition">decompose it</a>
into a factor tree whose leaves are prime factors.</p>

<p>To start, I&#8217;ll define &#8220;factor pairs&#8221;: a vector of two integers that
multiply to another. So, <code>[2 3]</code>  is a factor pair of 6, <code>[1 23]</code> a
factor pair of 23. Here&#8217;s the most general test I came up with:</p>

<figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span> <span class="o">`</span><span class="p">(</span><span class="nf">it</span> <span class="o">~@</span><span class="nv">args</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">([</span><span class="nv">_0</span> <span class="nv">_1</span><span class="p">])</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>There&#8217;s a lot of syntax right off the bat, but this test isn&#8217;t as
confusing as it might look. So far, I&#8217;ve found it easiest to understand logic programming as
describing a set of constraints on a solution. This test describes the
first constraint: factor pairs are vectors of two elements.</p>

<p>Here, <code>_0</code> and <code>_1</code> represent <em>reified</em>, <em>unbound</em> logic variables: symbolic
representations of logic variables that can take on any value. (The
numbers at the end indicate that they&#8217;re two different variables: <code>_0</code>
and <code>_1</code> can take on different values). So this
test simply describes the most general constraint: the <code>factor-pairs</code>
function should take something as an argument and return a list of
vectors of two things&#8211;any two things!.</p>

<p>Here&#8217;s a function that does just that:</p>

<figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>        <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>               <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>run*</code> function is the, uh, <em>core</em> of <code>core.logic</code>, used to set up
problems for the logic engine to solve. It returns a list of all the
solutions that match the constraints defined inside. The <code>fresh</code> form
inside of <code>run*</code> is
analogous to <code>let</code>: a way to declare local logic variables. The first
two lines say &#8220;Find all
the solutions where pair, factor1, and factor2 meet these
constraints,&#8221; and the third describes the only constraint: &#8220;A pair is a
vector of two elements, factor1 and factor2&#8221;.</p>

<p>Note that I&#8217;m ignoring the <code>number</code> argument! At this point
<code>(factor-pairs 81)</code>, <code>(factor-pairs 72)</code>, and <code>(factor-pairs 23)</code> all
return the same result. For now, calling this function <code>factor-pairs</code>
is a little misleading, since it returns the equivalent of all
possible pairs of two things. But now that the tests pass, we can add
another constraint:</p>

<figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span> <span class="o">`</span><span class="p">(</span><span class="nf">it</span> <span class="o">~@</span><span class="nv">args</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">%</span> <span class="nv">high</span><span class="p">))</span> <span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, I&#8217;ll describe the next constraint: factor pairs should only be
defined between 2 and n. (Yes, a pair like <code>[1 23]</code> is technically a
pair of factors, but it&#8217;s not very useful for my prime factorization purposes).</p>

<p>I may be open to a little <a href="http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd">TDD legal trouble</a>
with this test update, but I&#8217;ve added a couple helper functions to
keep the tests as declarative as possible. <code>Should-all</code> asserts that a
predicate matches for every element in a collection. <code>In-interval?</code>
tests whether a pair is in the range <code>low</code> to <code>high</code>, inclusive.
Hopefully, <code>Two-elements?</code> explains itself. Since <code>factor-pairs</code> will
now return a list with many elements, I&#8217;ve generalized the original test.</p>

<p>It only takes one line to add the extra constraint:</p>

<figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>        <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">in</span> <span class="nv">factor1</span> <span class="nv">factor2</span> <span class="p">(</span><span class="nf">interval</span> <span class="mi">2</span> <span class="nv">number</span><span class="p">))</span>
</span><span class='line'>               <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The new line declares that <code>factor1</code> and <code>factor2</code> must both be in the
finite interval 2-<code>number</code>. <code>Factor-pairs</code> is still something of a
misnomer: it now returns the Cartesian product of all numbers
2-<code>number</code>. But it&#8217;s a step closer. I&#8217;ll add one more constraint:</p>

<figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span> <span class="o">`</span><span class="p">(</span><span class="nf">it</span> <span class="o">~@</span><span class="nv">args</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">%</span> <span class="nv">high</span><span class="p">))</span> <span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Factor pairs contain two elements between 2 and n that equal n when
multiplied. That&#8217;s a complete definition of a factor pair, and adding
the third constraint completes the function:</p>

<figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>        <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">in</span> <span class="nv">factor1</span> <span class="nv">factor2</span> <span class="p">(</span><span class="nf">interval</span> <span class="mi">2</span> <span class="nv">number</span><span class="p">))</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nb">= </span><span class="nv">number</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">)))</span>
</span><span class='line'>               <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, <code>eq</code> converts an arithmetic expression into a constraint, as
long as the logic variables are defined over a finite domain. So the
final constraint simply says <code>number</code> must equal <code>factor1</code> times
<code>factor2</code>. If you&#8217;re not convinced by the tests, try it in a REPL:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)</span>
</span><span class='line'><span class="p">([</span><span class="mi">3</span> <span class="mi">27</span><span class="p">]</span> <span class="p">[</span><span class="mi">9</span> <span class="mi">9</span><span class="p">]</span> <span class="p">[</span><span class="mi">27</span> <span class="mi">3</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">148</span><span class="p">)</span>
</span><span class='line'><span class="p">([</span><span class="mi">2</span> <span class="mi">74</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">37</span><span class="p">]</span> <span class="p">[</span><span class="mi">37</span> <span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="mi">74</span> <span class="mi">2</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">)</span>
</span><span class='line'><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>There are some properties here that I&#8217;ll use to my advantage. First,
by default, factor pairs are ordered by the first factor, ascending.
Second, I&#8217;ve already created an implicit definition of primes: numbers
that return an empty list of factor pairs. I&#8217;ll add it as a test for
clarity:</p>

<figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span> <span class="o">`</span><span class="p">(</span><span class="nf">it</span> <span class="o">~@</span><span class="nv">args</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">%</span> <span class="nv">high</span><span class="p">))</span> <span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Prime numbers&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;have no factor pairs&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now I&#8217;ll move on to decomposition. If you&#8217;ve watched a prime factors
kata before, you&#8217;ve probably seen a few standard tests: start by
testing 1, then 2, then 3, and then composites. Here&#8217;s where something
similar comes in:</p>

<figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span> <span class="o">`</span><span class="p">(</span><span class="nf">it</span> <span class="o">~@</span><span class="nv">args</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">%</span> <span class="nv">high</span><span class="p">))</span> <span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Prime numbers&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;have no factor pairs&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Decomposition&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 1 into itself&quot;</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">1</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course, it&#8217;s easy to pass this one:</p>

<figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>        <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">in</span> <span class="nv">factor1</span> <span class="nv">factor2</span> <span class="p">(</span><span class="nf">interval</span> <span class="mi">2</span> <span class="nv">number</span><span class="p">))</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nb">= </span><span class="nv">number</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">)))</span>
</span><span class='line'>               <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">decompose</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;ll make it a little harder with the next bit of the definition.
Primes should decompose into themselves:</p>

<figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span> <span class="o">`</span><span class="p">(</span><span class="nf">it</span> <span class="o">~@</span><span class="nv">args</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">%</span> <span class="nv">high</span><span class="p">))</span> <span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Prime numbers&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;have no factor pairs&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Decomposition&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 1 into itself&quot;</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">1</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes primes into themselves&quot;</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">3</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">17</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">23</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;ll get back to passing with a small tweak. Instead of returning
<code>'(1)</code>, <code>decompose</code> should check if a number has any
factor pairs. If not, return the number.</p>

<figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>        <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">in</span> <span class="nv">factor1</span> <span class="nv">factor2</span> <span class="p">(</span><span class="nf">interval</span> <span class="mi">2</span> <span class="nv">number</span><span class="p">))</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nb">= </span><span class="nv">number</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">)))</span>
</span><span class='line'>               <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">decompose</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">factorpair</span> <span class="p">(</span><span class="nb">first </span><span class="p">(</span><span class="nf">factor-pairs</span> <span class="nv">number</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty?</span> <span class="nv">factorpair</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">number</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s the easy part, but what about composites? Well, two times a
prime should certainly decompose to 2 and the prime:</p>

<figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span> <span class="o">`</span><span class="p">(</span><span class="nf">it</span> <span class="o">~@</span><span class="nv">args</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">%</span> <span class="nv">high</span><span class="p">))</span> <span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Prime numbers&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;have no factor pairs&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Decomposition&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 1 into itself&quot;</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">1</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes primes into themselves&quot;</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">3</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">17</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">23</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 2 * a prime into 2 and itself&quot;</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">4</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>Decompose</code> already includes the base case at the bottom of of the
prime factor tree. If I feed it a number that&#8217;s not prime, it should
decompose its factors until it runs into a prime. Concatenating the
results should return a nice list of prime factors:</p>

<figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>        <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">in</span> <span class="nv">factor1</span> <span class="nv">factor2</span> <span class="p">(</span><span class="nf">interval</span> <span class="mi">2</span> <span class="nv">number</span><span class="p">))</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nb">= </span><span class="nv">number</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">)))</span>
</span><span class='line'>               <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">decompose</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">factorpair</span> <span class="p">(</span><span class="nb">first </span><span class="p">(</span><span class="nf">factor-pairs</span> <span class="nv">number</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty?</span> <span class="nv">factorpair</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">number</span><span class="p">)</span>
</span><span class='line'>        <span class="p">(</span><span class="nb">concat </span><span class="p">(</span><span class="nf">decompose</span> <span class="p">(</span><span class="nb">first </span><span class="nv">factorpair</span><span class="p">))</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">decompose</span> <span class="p">(</span><span class="nb">second </span><span class="nv">factorpair</span><span class="p">))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&#8217;s it! Here&#8217;s a last set of test cases to confirm that it
works:</p>

<figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span> <span class="o">`</span><span class="p">(</span><span class="nf">it</span> <span class="o">~@</span><span class="nv">args</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">%</span> <span class="nv">high</span><span class="p">))</span> <span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Prime numbers&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;have no factor pairs&quot;</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Decomposition&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 1 into itself&quot;</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">1</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes primes into themselves&quot;</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">3</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">17</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">23</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 2 * a prime into 2 and itself&quot;</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">4</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes a composite into its prime factorization&quot;</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">8</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">30</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">11</span> <span class="mi">11</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">242</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">5</span> <span class="mi">11</span> <span class="mi">23</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="p">(</span><span class="nb">* </span><span class="mi">23</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">11</span><span class="p">)))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>This isn&#8217;t the fastest way to find prime factors, but it&#8217;s no worse
than the typical trial division solution to the prime factors kata.
Using <code>core.logic</code> to declare definitions and constraints on the
solution feels uniquely concise, expressive, and clear, and the
exercise helped me get a more concrete handle on logic programming.
You can find the code from this post (and a few earlier iterations) <a href="https://gist.github.com/ecmendenhall/5970568">as
a Gist here</a>.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-07-14T23:49:00-05:00" data-updated="true" itemprop="datePublished">Jul 14<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/internet-explorer/'>Internet Explorer</a>, <a class='category' href='/blog/categories/rails/'>Rails</a>, <a class='category' href='/blog/categories/virtualbox/'>Virtualbox</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/blog/2013/07/14/accessing-rails-from-virtualbox/" itemprop="url">Accessing Rails From Virtualbox</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>My latest project involves adding a Flash fallback to replace an
HTML5-based feature in a Rails application. It&#8217;s the first time I&#8217;ve
tested in Internet Explorer over a virtual machine, and I spent a good
deal of time configuring everything. Here&#8217;s a summary of the process
for future VM novices.</p>

<h3>Get VirtualBox</h3>

<p>First, grab <a href="https://www.virtualbox.org/">VirtualBox</a>. It may be handy
for more than testing: in addition to
running Internet Explorer, you might want to try a new <a href="http://virtualboxes.org/images/">Linux
distro</a> or do some <a href="http://raidersec.blogspot.com/2013/03/installing-kali-linux-in-virtualbox.html">pen
testing</a>.</p>

<h3>Install an IE virtual machine</h3>

<p>Microsoft recently rolled out <a href="http://www.modern.ie/en-us/virtualization-tools#downloads">free virtual machine images</a> for IE
testing that greatly simplify the setup process. Download and extract the versions you&#8217;re interested in.
Some of these are distributed as full images, but most come as several <code>.rar</code> files and a
self-extracting archive. To extract from the command line:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ chmod +x MacVirtualBox.part1.sfx
</span><span class='line'>$ ./MacVirtualBox.part1.sfx</span></code></pre></td></tr></table></div></figure>


<p>This should create a new <code>.ova</code> file in the same directory. Open VirtualBox and import it (File > Import Appliance on OS X).</p>

<p><img src="/blog/images/vbox.png"></p>

<h3>Configure network settings</h3>

<p>Select the machine you&#8217;d like to connect from and choose Settings >
Network. Make sure the network adapter is enabled and attached to NAT.
(This should be the default setting).</p>

<p><img src="/blog/images/nat.png"></p>

<p>You can access the host machine
from inside the VM at 10.0.2.2&#8211;e.g., if you access your Rails dev server at
localhost:3000, you can connect at 10.0.2.2:3000. Unfortunately,
running my Rails dev server from the host machine resulted in
occasional redirects to localhost. Fix this by editing the Windows
hosts file.</p>

<p>The Windows hosts file is available in
<code>C:\windows\system32\drivers\etc\</code>. In XP, you&#8217;ll be able to edit it
directly with Notepad. On a Vista VM, you&#8217;ll need admin priviliges.
Find Notepad in the start menu, right click, and choose &#8220;Run as
Administrator.&#8221; Then, edit the hosts file to direct localhost to
10.0.2.2, the default VirtualBox address for the host machine.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>10.0.2.2 localhost</span></code></pre></td></tr></table></div></figure>


<p>Run your Rails dev server on the host machine, and connect to
localhost:3000 as usual. Congratulations! You&#8217;re ready for the joy of
Internet Explorer. For bonus points, configure Capybara to <a href="http://www.johng.co.uk/2010/10/13/run_capybara_and_cucumber_features_in_internet_explorer_on_remote_windows/">run in IE</a>.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-07-14T22:28:00-05:00" data-updated="true" itemprop="datePublished">Jul 14<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/clojure/'>Clojure</a>, <a class='category' href='/blog/categories/python/'>Python</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/blog/2013/07/14/clojure-namespaces-for-python-programmers/" itemprop="url">Clojure Namespaces for Python Programmers</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>My mentor <a href="https://twitter.com/trptcolin">Colin</a> wrote one of the most
popular posts on the <a href="http://blog.8thlight.com/">8th Light blog</a>, on
the somewhat complex process of <a href="http://blog.8thlight.com/colin-jones/2010/12/05/clojure-libs-and-namespaces-require-use-import-and-ns.html">requiring Clojure
libs</a>.
It&#8217;s not a stretch to give it some of the credit for my interest in
Clojure: I came close to giving up in frustration the first time I
tried to import a library in a Clojure REPL. It was <a href="http://xkcd.com/353/">so easy in
Python</a>, and there I was, suddenly dealing with
macros, keywords, quotes, and&#8211;heaven forfend!&#8211;all those parentheses.</p>

<p>For all the details on namespaces, <code>require</code>, and the <code>ns</code> macro, see
<a href="http://blog.8thlight.com/colin-jones/2010/12/05/clojure-libs-and-namespaces-require-use-import-and-ns.html">Colin&#8217;s
post</a>,
which is still the authoritative source. But if you&#8217;re a Python
programmer looking for a quick reference, here&#8217;s the Python-Clojure
Rosetta stone I went looking for the first time I deadpanned into my
Clojure REPL.</p>

<h2>Import a library</h2>

<figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">library</span>
</span><span class='line'>
</span><span class='line'><span class="n">library</span><span class="o">.</span><span class="n">dostuff</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="nv">library</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">library/dostuff</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>REPL </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">library</span>
</span><span class='line'>
</span><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">library</span><span class="o">.</span><span class="n">dostuff</span><span class="p">()</span>
</span><span class='line'><span class="s">&quot;did stuff!&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;library</span><span class="p">)</span>
</span><span class='line'><span class="nv">nil</span>
</span><span class='line'>
</span><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">library/dostuff</span><span class="p">)</span>
</span><span class='line'><span class="s">&quot;did stuff!&quot;</span>
</span><span class='line'><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Import everything without qualification</h2>

<p>(Note: This practice is usually as ill-advised in Clojure as it is in Python!)</p>

<figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'>
</span><span class='line'><span class="n">dostuff</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">dostuff</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>REPL </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'>
</span><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">dostuff</span><span class="p">()</span>
</span><span class='line'><span class="s">&quot;did stuff!&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'><span class="nv">nil</span>
</span><span class='line'>
</span><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">dostuff</span><span class="p">)</span>
</span><span class='line'><span class="s">&quot;did stuff!&quot;</span>
</span><span class='line'><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Import specific functions</h2>

<figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">dostuff</span><span class="p">,</span> <span class="n">returnthings</span>
</span><span class='line'>
</span><span class='line'><span class="n">dostuff</span><span class="p">()</span>
</span><span class='line'><span class="n">returnthings</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">dostuff</span> <span class="nv">returnthings</span><span class="p">]]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">dostuff</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nf">returnthings</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>REPL </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">dostuff</span><span class="p">,</span> <span class="n">returnthings</span>
</span><span class='line'>
</span><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">dostuff</span><span class="p">()</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">returnthings</span><span class="p">()</span>
</span><span class='line'><span class="n">Out</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">{</span> <span class="s">&quot;foo&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">dostuff</span> <span class="nv">returnthings</span><span class="p">]])</span>
</span><span class='line'><span class="nv">nil</span>
</span><span class='line'>
</span><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">dostuff</span><span class="p">)</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span><span class='line'><span class="nv">nil</span>
</span><span class='line'>
</span><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">returnthings</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span> <span class="ss">:foo</span> <span class="mi">1</span> <span class="ss">:bar</span> <span class="mi">2</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Import and rename a library</h2>

<figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">library</span> <span class="kn">as</span> <span class="nn">lib</span>
</span><span class='line'>
</span><span class='line'><span class="n">lib</span><span class="o">.</span><span class="n">dostuff</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">library</span> <span class="ss">:as</span> <span class="nv">lib</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">lib/dostuff</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>REPL </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">library</span> <span class="kn">as</span> <span class="nn">lib</span>
</span><span class='line'>
</span><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">lib</span><span class="o">.</span><span class="n">dostuff</span><span class="p">()</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">library</span> <span class="ss">:as</span> <span class="nv">lib</span><span class="p">])</span>
</span><span class='line'><span class="nv">nil</span>
</span><span class='line'>
</span><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">lib/dostuff</span><span class="p">)</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span><span class='line'><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Import and rename a function</h2>

<figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">dostuff</span> <span class="k">as</span> <span class="n">ds</span>
</span><span class='line'>
</span><span class='line'><span class="n">ds</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">dostuff</span><span class="p">]</span> <span class="ss">:rename</span> <span class="p">{</span><span class="nv">dostuff</span> <span class="nv">ds</span><span class="p">}]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">ds</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>REPL </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">dostuff</span> <span class="k">as</span> <span class="n">ds</span>
</span><span class='line'>
</span><span class='line'><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">ds</span><span class="p">()</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">dostuff</span><span class="p">]</span> <span class="ss">:rename</span> <span class="p">{</span><span class="nv">dostuff</span> <span class="nv">ds</span><span class="p">}])</span>
</span><span class='line'><span class="nv">nil</span>
</span><span class='line'>
</span><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">ds</span><span class="p">)</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span><span class='line'><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure>


<h2>All together, now!</h2>

<figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">onelibrary</span><span class="o">,</span> <span class="nn">anotherlibrary</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">onemorelibrary</span> <span class="kn">as</span> <span class="nn">oml</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">returnthings</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">dostuff</span> <span class="k">as</span> <span class="n">ds</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">onelibrary</span>
</span><span class='line'>             <span class="nv">anotherlibrary</span>
</span><span class='line'>             <span class="p">[</span><span class="nv">onemorelibrary</span> <span class="ss">:as</span> <span class="nv">oml</span><span class="p">]</span>
</span><span class='line'>             <span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">dostuff</span> <span class="nv">returnthings</span><span class="p">]</span>
</span><span class='line'>                      <span class="ss">:rename</span> <span class="p">{</span><span class="nv">dostuff</span> <span class="nv">ds</span><span class="p">}]]))</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-24T12:00:00-05:00" data-updated="true" itemprop="datePublished">Jun 24<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/breadth-first-numbering/'>Breadth-first numbering</a>, <a class='category' href='/blog/categories/functional-programming/'>Functional programming</a>, <a class='category' href='/blog/categories/lisp/'>Lisp</a>, <a class='category' href='/blog/categories/racket/'>Racket</a>, <a class='category' href='/blog/categories/scheme/'>Scheme</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/blog/2013/06/24/breadth-first-numbering-a-solution/" itemprop="url">Breadth-first Numbering: A Solution</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Now that we&#8217;ve built an <a href="blog/2013/06/24/breadth-first-numbering-a-lazy-functional-queue/">efficient functional
queue</a>,
we can finally put it to work in a breadth-first numbering solution.</p>

<p>First, let&#8217;s define a few trees up front for testing. The first is the
example given in the introduction of <a href="http://www.cs.tufts.edu/~nr/cs257/archive/chris-okasaki/breadth-first.pdf">the
paper</a>.
The other two are a little trickier, and the twelve-node tree is not binary.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='scheme'><span class='line'><span class="p">(</span><span class="k">define </span><span class="nv">example-tree</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="p">(</span><span class="s">&quot;B&quot;</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                <span class="p">(</span><span class="s">&quot;C&quot;</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                     <span class="s">&quot;leaf&quot;</span><span class="p">))</span>
</span><span class='line'>                           <span class="p">(</span><span class="s">&quot;D&quot;</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                            <span class="s">&quot;leaf&quot;</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="nv">five-nodes</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="p">(</span><span class="s">&quot;B&quot;</span> <span class="p">(</span><span class="s">&quot;D&quot;</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                   <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                              <span class="p">(</span><span class="s">&quot;E&quot;</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                   <span class="s">&quot;leaf&quot;</span><span class="p">))</span>
</span><span class='line'>                         <span class="p">(</span><span class="s">&quot;C&quot;</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                              <span class="s">&quot;leaf&quot;</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="k">define </span><span class="nv">twelve-nodes</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="p">(</span><span class="s">&quot;B&quot;</span> <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                           <span class="p">(</span><span class="s">&quot;C&quot;</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                <span class="p">(</span><span class="s">&quot;D&quot;</span> <span class="p">(</span><span class="s">&quot;F&quot;</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                          <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                     <span class="p">(</span><span class="s">&quot;G&quot;</span> <span class="p">(</span><span class="s">&quot;I&quot;</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                               <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                          <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                     <span class="p">(</span><span class="s">&quot;H&quot;</span> <span class="p">(</span><span class="s">&quot;J&quot;</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                               <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                               <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                          <span class="p">(</span><span class="s">&quot;K&quot;</span> <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                          <span class="p">(</span><span class="s">&quot;L&quot;</span> <span class="s">&quot;leaf&quot;</span><span class="p">)))</span>
</span><span class='line'>                                <span class="p">(</span><span class="s">&quot;E&quot;</span> <span class="s">&quot;leaf&quot;</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>To calculate the visit order, we can perform a simple <a href="https://en.wikipedia.org/wiki/Breadth-first_search">breadth-first
traversal</a> of the
tree. Now that we have a queue, the solution is pretty close to the pseudocode: Start with the
root node in the queue, and assign it a number. Then recur with three
new parameters: A queue with this node&#8217;s children inserted, a list
with this node&#8217;s number consed on, and an incremented node number.
When the queue is empty, we&#8217;re done:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='scheme'><span class='line'><span class="p">(</span><span class="k">define </span><span class="nv">visit-order</span>
</span><span class='line'>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">tree</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="k">define </span><span class="nv">bfs-iter</span>
</span><span class='line'>      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">queue</span> <span class="nv">visited</span> <span class="nv">n</span><span class="p">)</span>
</span><span class='line'>        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nf">rem</span> <span class="nv">queue</span><span class="p">))</span> <span class="nv">visited</span>
</span><span class='line'>            <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">node</span>  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">rem</span> <span class="nv">queue</span><span class="p">)))</span>
</span><span class='line'>                  <span class="p">(</span><span class="nf">new-q</span> <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">rem</span> <span class="nv">queue</span><span class="p">)))))</span>
</span><span class='line'>              <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="s">&quot;leaf&quot;</span> <span class="nv">node</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">(</span><span class="nf">bfs-iter</span> <span class="nv">new-q</span> <span class="nv">visited</span> <span class="nv">n</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">(</span><span class="nf">bfs-iter</span> <span class="p">(</span><span class="nf">ins-items</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">node</span><span class="p">)</span> <span class="nv">new-q</span><span class="p">)</span>
</span><span class='line'>                            <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">node</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">visited</span><span class="p">)</span>
</span><span class='line'>                            <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">n</span><span class="p">)))))))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">bfs-iter</span> <span class="p">(</span><span class="nf">ins</span> <span class="nv">tree</span> <span class="nv">empty-q</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">()</span> <span class="mi">1</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">check-equal?</span>  <span class="p">(</span><span class="nf">visit-order</span> <span class="nv">example-tree</span><span class="p">)</span>
</span><span class='line'>              <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;C&quot;</span> <span class="o">.</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;D&quot;</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;B&quot;</span><span class="o">.</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="o">.</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>              <span class="s">&quot;Visit-order searches a tree breadth-first and returns a</span>
</span><span class='line'><span class="s">              list of nodes and their numbers.&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">check-equal?</span>  <span class="p">(</span><span class="nf">visit-order</span> <span class="nv">five-nodes</span><span class="p">)</span>
</span><span class='line'>              <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;E&quot;</span> <span class="o">.</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;D&quot;</span> <span class="o">.</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;C&quot;</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;B&quot;</span> <span class="o">.</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="o">.</span> <span class="mi">1</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">check-equal?</span>   <span class="p">(</span><span class="nf">visit-order</span> <span class="nv">twelve-nodes</span><span class="p">)</span>
</span><span class='line'>               <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;L&quot;</span> <span class="o">.</span> <span class="mi">12</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;K&quot;</span> <span class="o">.</span> <span class="mi">11</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;J&quot;</span> <span class="o">.</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;I&quot;</span> <span class="o">.</span> <span class="mi">9</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;H&quot;</span> <span class="o">.</span> <span class="mi">8</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;G&quot;</span> <span class="o">.</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;F&quot;</span> <span class="o">.</span> <span class="mi">6</span><span class="p">)</span>
</span><span class='line'>                 <span class="p">(</span><span class="s">&quot;E&quot;</span> <span class="o">.</span> <span class="mi">5</span><span class="p">)</span>  <span class="p">(</span><span class="s">&quot;D&quot;</span> <span class="o">.</span> <span class="mi">4</span><span class="p">)</span>  <span class="p">(</span><span class="s">&quot;C&quot;</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span>  <span class="p">(</span><span class="s">&quot;B&quot;</span> <span class="o">.</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="o">.</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>               <span class="s">&quot;Visit-order works on non-binary trees.&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&#8217;s possible to map a visit queue back to a binary tree (check out
 Michael&#8217;s <a href="https://gist.github.com/MichaelBaker/5810053">concise Haskell
 solution</a>), but I
 wanted a solution that would work for all trees. In the end, I settled for performing a second <a href="https://en.wikipedia.org/wiki/Depth-first_search">depth-first
 traversal</a>
to label nodes. This <code>walk-map</code> function works like a recursive <code>map</code>,
 traversing a nested structure and applying a function to every
 element that&#8217;s not a list:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scheme'><span class='line'><span class="p">(</span><span class="k">define </span><span class="nv">walk-map</span>
</span><span class='line'>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">func</span> <span class="nv">items</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="k">define </span><span class="nv">apply-or-map</span>
</span><span class='line'>      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">item</span><span class="p">)</span>
</span><span class='line'>        <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">item</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">())</span>
</span><span class='line'>              <span class="p">((</span><span class="nb">pair? </span><span class="nv">item</span><span class="p">)</span> <span class="p">(</span><span class="nb">map </span><span class="nv">apply-or-map</span> <span class="nv">item</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">func</span> <span class="nv">item</span><span class="p">)))))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">map </span><span class="nv">apply-or-map</span> <span class="nv">items</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">check-equal?</span>  <span class="p">(</span><span class="nf">walk-map</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="s">&quot;one&quot;</span><span class="p">)</span> <span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">2</span><span class="p">)</span> <span class="s">&quot;two&quot;</span><span class="p">)</span> <span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">3</span><span class="p">)</span> <span class="s">&quot;three&quot;</span><span class="p">)</span> <span class="p">))</span>
</span><span class='line'>              <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">3</span> <span class="p">(</span><span class="mi">1</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">))))</span>
</span><span class='line'>              <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;one&quot;</span> <span class="s">&quot;two&quot;</span> <span class="p">(</span><span class="s">&quot;one&quot;</span> <span class="s">&quot;one&quot;</span> <span class="s">&quot;two&quot;</span> <span class="p">(</span><span class="s">&quot;three&quot;</span> <span class="p">(</span><span class="s">&quot;one&quot;</span> <span class="p">(</span><span class="s">&quot;two&quot;</span><span class="p">)</span><span class="s">&quot;two&quot;</span><span class="p">)</span> <span class="s">&quot;one&quot;</span> <span class="s">&quot;three&quot;</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&#8217;s a convenience function to store node order in a hash set:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='scheme'><span class='line'><span class="p">(</span><span class="k">define </span><span class="nv">make-label-map</span>
</span><span class='line'>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">labels</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">label-map</span> <span class="p">(</span><span class="nf">make-hash</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="k">define </span><span class="nv">add-labels</span>
</span><span class='line'>        <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">labels</span><span class="p">)</span>
</span><span class='line'>          <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">labels</span><span class="p">)</span>
</span><span class='line'>              <span class="nv">label-map</span>
</span><span class='line'>              <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">node</span>   <span class="p">(</span><span class="nb">car </span> <span class="p">(</span><span class="nb">car </span><span class="nv">labels</span><span class="p">)))</span>
</span><span class='line'>                    <span class="p">(</span><span class="nf">number</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="nv">labels</span><span class="p">))))</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">hash-set!</span> <span class="nv">label-map</span> <span class="nv">node</span> <span class="nv">number</span><span class="p">)</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">add-labels</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">labels</span><span class="p">))))))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">add-labels</span> <span class="nv">labels</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">label-map</span> <span class="p">(</span><span class="nf">make-label-map</span> <span class="p">(</span><span class="nf">visit-order</span> <span class="nv">example-tree</span><span class="p">))))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">check-equal?</span> <span class="p">(</span><span class="nf">hash-ref</span> <span class="nv">label-map</span> <span class="s">&quot;A&quot;</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">check-equal?</span> <span class="p">(</span><span class="nf">hash-ref</span> <span class="nv">label-map</span> <span class="s">&quot;B&quot;</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">check-equal?</span> <span class="p">(</span><span class="nf">hash-ref</span> <span class="nv">label-map</span> <span class="s">&quot;C&quot;</span><span class="p">)</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">check-equal?</span> <span class="p">(</span><span class="nf">hash-ref</span> <span class="nv">label-map</span> <span class="s">&quot;D&quot;</span><span class="p">)</span> <span class="mi">3</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And at long last, a solution for breadth-first numbering: calculate
node order, then map over the tree to apply the labels:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='scheme'><span class='line'><span class="p">(</span><span class="k">define </span><span class="nv">number-tree</span>
</span><span class='line'>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">tree</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">label-map</span> <span class="p">(</span><span class="nf">make-label-map</span> <span class="p">(</span><span class="nf">visit-order</span> <span class="nv">tree</span><span class="p">))))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">walk-map</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">node</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="s">&quot;leaf&quot;</span> <span class="nv">node</span><span class="p">)</span>
</span><span class='line'>                                   <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                               <span class="p">(</span><span class="nf">hash-ref</span> <span class="nv">label-map</span> <span class="nv">node</span><span class="p">)))</span>
</span><span class='line'>                <span class="nv">tree</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">check-equal?</span> <span class="p">(</span><span class="nf">number-tree</span> <span class="nv">example-tree</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="p">(</span><span class="mi">2</span> <span class="s">&quot;leaf&quot;</span> <span class="p">(</span><span class="mi">4</span> <span class="s">&quot;leaf&quot;</span> <span class="s">&quot;leaf&quot;</span><span class="p">))</span> <span class="p">(</span><span class="mi">3</span> <span class="s">&quot;leaf&quot;</span> <span class="s">&quot;leaf&quot;</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="nf">check-equal?</span> <span class="p">(</span><span class="nf">number-tree</span> <span class="nv">five-nodes</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="p">(</span><span class="mi">2</span> <span class="p">(</span><span class="mi">4</span> <span class="s">&quot;leaf&quot;</span> <span class="s">&quot;leaf&quot;</span><span class="p">)</span> <span class="p">(</span><span class="mi">5</span> <span class="s">&quot;leaf&quot;</span> <span class="s">&quot;leaf&quot;</span><span class="p">))</span> <span class="p">(</span><span class="mi">3</span> <span class="s">&quot;leaf&quot;</span> <span class="s">&quot;leaf&quot;</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="nf">check-equal?</span> <span class="p">(</span><span class="nf">number-tree</span> <span class="nv">twelve-nodes</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span>
</span><span class='line'>                                           <span class="p">(</span><span class="mi">2</span> <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                           <span class="p">(</span><span class="mi">3</span>
</span><span class='line'>                                              <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                              <span class="p">(</span><span class="mi">4</span>
</span><span class='line'>                                                <span class="p">(</span><span class="mi">6</span> <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                                   <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                                <span class="p">(</span><span class="mi">7</span> <span class="p">(</span><span class="mi">9</span>     <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                                          <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                                   <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                                <span class="p">(</span><span class="mi">8</span> <span class="p">(</span><span class="mi">10</span>    <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                                          <span class="s">&quot;leaf&quot;</span>
</span><span class='line'>                                                          <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                                   <span class="p">(</span><span class="mi">11</span>    <span class="s">&quot;leaf&quot;</span><span class="p">)</span>
</span><span class='line'>                                                   <span class="p">(</span><span class="mi">12</span>    <span class="s">&quot;leaf&quot;</span><span class="p">)))</span>
</span><span class='line'>                                              <span class="p">(</span><span class="mi">5</span>   <span class="s">&quot;leaf&quot;</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>On the plus side, this solution generalizes to non-binary trees, and
is built almost entirely out of Scheme primitives. It&#8217;s not as concise
or efficient as I&#8217;d like, but I&#8217;m happy with my lazy lists and
functional queue, even if the implementation is a little long. You can
find an edited version of my solution
<a href="https://gist.github.com/ecmendenhall/5847792">here</a>, and all the code
from these posts as a Gist <a href="https://gist.github.com/ecmendenhall/5847793">here</a>.</p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Connor Mendenhall -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/blog/javascripts/slash.js"></script>
<script src="/blog/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'ecmgithub';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-40424493-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
