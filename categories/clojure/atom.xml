<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Clojure | Connor Mendenhall]]></title>
  <link href="http://ecmendenhall.github.io/blog/categories/clojure/atom.xml" rel="self"/>
  <link href="http://ecmendenhall.github.io/blog/"/>
  <updated>2013-09-05T16:13:05-05:00</updated>
  <id>http://ecmendenhall.github.io/blog/</id>
  <author>
    <name><![CDATA[Connor Mendenhall]]></name>
    <email><![CDATA[ecmendenhall@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Clean Clojure: Small functions]]></title>
    <link href="http://ecmendenhall.github.io/blog/blog/2013/09/05/clean-clojure-functions/"/>
    <updated>2013-09-05T10:22:00-05:00</updated>
    <id>http://ecmendenhall.github.io/blog/blog/2013/09/05/clean-clojure-functions</id>
    <content type="html"><![CDATA[<p><em>This is part 2 in <a href="http://ecmendenhall.github.io/blog/categories/clean-clojure/">a series</a> on clean Clojure. Previously: <a href="http://ecmendenhall.github.io/blog/blog/2013/09/02/clean-clojure-meaningful-names/">meaningful names</a>.</em></p>

<p>In <em>Clean Code</em>, Uncle Bob proposes two rules for good functions: "The first rule of
functions is that they should be small. The second rule of functions
is that they should be <em>smaller than that</em>." Useful rules, but Clojure
requires one more: <em>they're still not small enough</em>.</p>

<p>Functional
languages and immutable data make reasoning easy by making functions
simpler. Functions take input, transform it, and return new output. Data passes
through functions, flowing rather than mutating. Complicated functions
<a href="http://www.infoq.com/presentations/Simple-Made-Easy">make simple
hard</a>, and they
can be dangerously easy to write.</p>

<p>Hyperbole aside, there really are two simple rules for functions: they
should be small, and do one thing. In his <a href="http://vimeo.com/13702091">presentation on
functions</a>, Uncle Bob describes a simple
algorithm for cleaning up crufty functions:</p>

<ol>
<li>Pick a function.</li>
<li>Extract functions until it does one thing.</li>
<li>Recur on extracted functions.</li>
</ol>


<p>Instead of a contrived wombat example, I'll use one of my own
disgusting old 4Clojure solutions as an example of atrocious code. (But cut me some slack! I was
young and naive.)</p>

<p>Here's the problem:</p>

<blockquote><p>"Write a function which takes a collection of integers as an argument.
 Return the count of how many elements are smaller than the sum of
 their squared component digits. For example: 10 is larger than 1
 squared plus 0 squared; whereas 15 is smaller than 1 squared plus 5
 squared."</p></blockquote>

<p>And here's my answer (hide the children):</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">elements</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">lt-sqd-components&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>      <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">digits</span>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">)))</span>
</span><span class='line'>            <span class="nv">squares</span> <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">)</span>
</span><span class='line'>            <span class="nv">sqsum</span>   <span class="p">(</span><span class="nb">reduce + </span><span class="nv">squares</span><span class="p">)]</span>
</span><span class='line'>        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n sqsum)</span>
</span><span class='line'>          <span class="nv">true</span>
</span><span class='line'>          <span class="nv">false</span><span class="p">)))]</span>
</span><span class='line'><span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter true? </span><span class="p">(</span><span class="nb">map </span><span class="nv">lt-sqd-components</span> <span class="nv">elements</span><span class="p">)))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Like nested blocks in other languages, code that sprawls rightward
indicates a problem&mdash;and it can happen fast in Clojure.
To start, we'll extract <code>lt-sqd-components</code> from the <code>let</code> binding.
(This is a common, awful 4Clojure hack for defining a named function
inside an anonymous one, though the discerning 4Clojurist uses <a href="http://clojuredocs.org/clojure_core/clojure.core/letfn"><code>letfn</code></a>).</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">lt-sqd-components&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">digits</span>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">)))</span>
</span><span class='line'>         <span class="nv">squares</span> <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">sqsum</span>   <span class="p">(</span><span class="nb">reduce + </span><span class="nv">squares</span><span class="p">)]</span>
</span><span class='line'>     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n sqsum)</span>
</span><span class='line'>          <span class="nv">true</span>
</span><span class='line'>          <span class="nv">false</span><span class="p">)))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">elements</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span><span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter true? </span><span class="p">(</span><span class="nb">map </span><span class="nv">lt-sqd-components</span> <span class="nv">elements</span><span class="p">)))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The original function is almost readable, but we can do better. It
looks like I didn't understand <code>filter</code> when I wrote this: the extra
<code>map</code> is redundant since <code>lt-sqd-components</code> is already a predicate function that
returns <code>true</code> or <code>false</code>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">lt-sqd-components&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">digits</span>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">)))</span>
</span><span class='line'>         <span class="nv">squares</span> <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">sqsum</span>   <span class="p">(</span><span class="nb">reduce + </span><span class="nv">squares</span><span class="p">)]</span>
</span><span class='line'>     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n sqsum)</span>
</span><span class='line'>          <span class="nv">true</span>
</span><span class='line'>          <span class="nv">false</span><span class="p">)))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">elements</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">lt-sqd-components</span> <span class="nv">elements</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>This does one thing, so let's clean it up and move on. It needs a
name, and the function we're filtering against needs a question mark.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">lt-sqd-components?&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">digits</span>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">)))</span>
</span><span class='line'>         <span class="nv">squares</span> <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">sqsum</span>   <span class="p">(</span><span class="nb">reduce + </span><span class="nv">squares</span><span class="p">)]</span>
</span><span class='line'>     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n sqsum)</span>
</span><span class='line'>          <span class="nv">true</span>
</span><span class='line'>          <span class="nv">false</span><span class="p">)))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">lt-sqd-components?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And now the recursive step. Let's look at the terribly-named
<code>lt-sqd-components</code>. Each line in its <code>let</code> binding does something
 different. One splits a number into a sequence of its digits:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">split-digits</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="k">def </span><span class="nv">lt-sqd-components&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">digits</span>  <span class="p">(</span><span class="nf">split-digits</span> <span class="nv">n</span><span class="p">)))</span>
</span><span class='line'>         <span class="nv">squares</span> <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">sqsum</span>   <span class="p">(</span><span class="nb">reduce + </span><span class="nv">squares</span><span class="p">)]</span>
</span><span class='line'>     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n sqsum)</span>
</span><span class='line'>          <span class="nv">true</span>
</span><span class='line'>          <span class="nv">false</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">lt-sqd-components?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>One squares every element in a sequence:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">split-digits</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square-all</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="k">def </span><span class="nv">lt-sqd-components?&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">digits</span>  <span class="p">(</span><span class="nf">split-digits</span> <span class="nv">n</span><span class="p">)))</span>
</span><span class='line'>         <span class="nv">squares</span> <span class="p">(</span><span class="nf">square-all</span> <span class="nv">digits</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">sqsum</span>   <span class="p">(</span><span class="nb">reduce + </span><span class="nv">squares</span><span class="p">)]</span>
</span><span class='line'>     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n sqsum)</span>
</span><span class='line'>          <span class="nv">true</span>
</span><span class='line'>          <span class="nv">false</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">lt-sqd-components?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And one takes the sum of the collection.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">split-digits</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square-all</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squares</span> <span class="p">[</span><span class="nv">squares</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">reduce + </span><span class="nv">squares</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="k">def </span><span class="nv">lt-sqd-components?&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">digits</span>  <span class="p">(</span><span class="nf">split-digits</span> <span class="nv">n</span><span class="p">)))</span>
</span><span class='line'>         <span class="nv">squares</span> <span class="p">(</span><span class="nf">square-all</span> <span class="nv">digits</span><span class="p">)</span>
</span><span class='line'>         <span class="nv">sqsum</span>   <span class="p">(</span><span class="nf">sum-of-squares</span> <span class="nv">squares</span><span class="p">)]</span>
</span><span class='line'>     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n sqsum)</span>
</span><span class='line'>          <span class="nv">true</span>
</span><span class='line'>          <span class="nv">false</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">lt-sqd-components?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>One more function to extract: the <code>let</code> binding should be its own
function. One might argue that this function does one thing&mdash;all it
does is check whether a number is less than the sum of its squared components!
But it's operating on several different levels of abstraction: digits,
a sequence of digits, and their sum. A helpful guideline is limiting
functions to one level of abstraction. In this case, the function
should only know about the sum.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">split-digits</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square-all</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squares</span> <span class="p">[</span><span class="nv">squares</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">reduce + </span><span class="nv">squares</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squared-components</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">digits</span>  <span class="p">(</span><span class="nf">split-digits</span> <span class="nv">n</span><span class="p">)</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="nv">squares</span> <span class="p">(</span><span class="nf">square-all</span> <span class="nv">digits</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">sqsum</span>   <span class="p">(</span><span class="nf">sum-of-squares</span> <span class="nv">squares</span><span class="p">)]</span>
</span><span class='line'><span class="nv">sqsum</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="k">def </span><span class="nv">lt-sqd-components?&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>     <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n (sum-of-squared-components n)))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">lt-sqd-components?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Despite its dumb name, <code>lt-sqd-components?</code> is doing one thing. Let's
clean it up. I prefer "digits" to "components", and it should use <code>defn</code>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">split-digits</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square-all</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squares</span> <span class="p">[</span><span class="nv">squares</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">reduce + </span><span class="nv">squares</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squared-digits</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">digits</span>  <span class="p">(</span><span class="nf">split-digits</span> <span class="nv">n</span><span class="p">)</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="nv">squares</span> <span class="p">(</span><span class="nf">square-all</span> <span class="nv">digits</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">sqsum</span>   <span class="p">(</span><span class="nf">sum-of-squares</span> <span class="nv">squares</span><span class="p">)]</span>
</span><span class='line'><span class="nv">sqsum</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">less-than-sum-of-digits-squared?</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n (sum-of-squared-digits n)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">less-than-sum-of-digits-squared?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>On to <code>sum-of-squared-digits</code>. We can transform the <code>let</code> binding into a function using the
<a href="http://clojuredocs.org/clojure_core/clojure.core/-%3E">threading macro</a> (as suggested <a href="http://ecmendenhall.github.io/blog/blog/2013/09/02/clean-clojure-meaningful-names/#comment-1029797833">in the comments</a> on my last post).</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">split-digits</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square-all</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squares</span> <span class="p">[</span><span class="nv">squares</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">reduce + </span><span class="nv">squares</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squared-components</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">-&gt; </span><span class="nv">n&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>  <span class="nv">split-digits</span>
</span><span class='line'>  <span class="nv">square-all</span>
</span><span class='line'>  <span class="nv">sum-of-squares</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">less-than-sum-of-digits-squared?</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n (sum-of-squared-digits n)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">lt-sqd-components?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>We can do better. I don't like the intermediate <code>square-all</code> step,
which should be hidden in <code>sum-of-squares</code>:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">split-digits</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square-all</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="nv">%</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">digits</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squares</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">reduce + </span><span class="p">(</span><span class="nf">square-all</span> <span class="nv">digits</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squared-components</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">-&gt; </span><span class="nv">n&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>  <span class="nv">split-digits</span>
</span><span class='line'>  <span class="nv">sum-of-squares</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">less-than-sum-of-digits-squared?</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n (sum-of-squared-digits n)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">lt-sqd-components?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Extract the function literal in <code>square-all</code>. I've got a great name
for it:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">split-digits</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">%</span><span class="p">)</span> <span class="mi">48</span><span class="p">)</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">n</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="p">(</span><span class="nb">* </span><span class="nv">n</span> <span class="nv">n</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square-all</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="nv">square</span> <span class="nv">digits</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squares</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">reduce + </span><span class="p">(</span><span class="nf">square-all</span> <span class="nv">digits</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squared-components</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">-&gt; </span><span class="nv">n&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>  <span class="nv">split-digits</span>
</span><span class='line'>  <span class="nv">sum-of-squares</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">less-than-sum-of-digits-squared?</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n (sum-of-squared-digits n)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">lt-sqd-components?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And there's only one function left: splitting a number into a sequence
of digits. Let's extract and name the function literal:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">char-&gt;num</span> <span class="p">[</span><span class="nv">character</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">int </span><span class="nv">character</span><span class="p">)</span> <span class="mi">48</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">split-digits</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="nv">char-&gt;num</span> <span class="p">(</span><span class="nb">seq </span><span class="p">(</span><span class="nb">str </span><span class="nv">number</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="p">(</span><span class="nb">* </span><span class="nv">n</span> <span class="nv">n</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square-all</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="nv">square</span> <span class="nv">digits</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squares</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">reduce + </span><span class="p">(</span><span class="nf">square-all</span> <span class="nv">digits</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squared-components</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">-&gt; </span><span class="nv">n&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>  <span class="nv">split-digits</span>
</span><span class='line'>  <span class="nv">sum-of-squares</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">less-than-sum-of-digits-squared?</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; n (sum-of-squared-digits n)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">lt-sqd-components?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And finally, clean it up by using <code>Integer/parseInt</code> instead of hacky
subtraction:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">char-&gt;num</span> <span class="p">[</span><span class="nv">character</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="p">(</span><span class="nb">str </span><span class="nv">character</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">split-digits</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="nv">char-&gt;num</span> <span class="p">(</span><span class="nb">str </span><span class="nv">number</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span> <span class="p">(</span><span class="nb">* </span><span class="nv">n</span> <span class="nv">n</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">square-all</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">map </span><span class="nv">square</span> <span class="nv">digits</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squares</span> <span class="p">[</span><span class="nv">digits</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">reduce + </span><span class="p">(</span><span class="nf">square-all</span> <span class="nv">digits</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">sum-of-squared-digits</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">-&gt; </span><span class="nv">n&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>  <span class="nv">split-digits</span>
</span><span class='line'>  <span class="nv">sum-of-squares</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">less-than-sum-of-digits-squared?</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; number&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span> <span class="p">(</span><span class="nf">sum-of-squared-digits</span> <span class="nv">number</span><span class="p">)))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">count-less-than-sum-of-squares</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter </span><span class="nv">less-than-sum-of-digits-squared?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And there it is&mdash;clean, readable functions at all levels of
abstraction, minimal nesting, and nothing longer than three lines.
Starting from the top, low-level functions build into bigger
abstractions through combination and composition. Each step is easy to
read and comprehend.</p>

<p>As Uncle Bob puts it in <em>Clean Code</em>:</p>

<blockquote><p>Master programmers think of systems as stories to be told rather than programs to be written. They use the facilities of their chosen programming language to construct a much richer and more expressive language that can be used to tell that story. Part of that domain-specific language is the hierarchy of functions that describe all the actions that take place within that system. In an artful act of recursion, those actions are written to use the very domain-specific language they define to tell their own small part of the story.</p></blockquote>

<p>Extract. Simplify. Recur. Take the time to consider each line, and clean code comes naturally.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Clean Clojure: Meaningful names]]></title>
    <link href="http://ecmendenhall.github.io/blog/blog/2013/09/02/clean-clojure-meaningful-names/"/>
    <updated>2013-09-02T22:35:00-05:00</updated>
    <id>http://ecmendenhall.github.io/blog/blog/2013/09/02/clean-clojure-meaningful-names</id>
    <content type="html"><![CDATA[<p>I came to 8th Light for a chance to write Clojure, and in the last few
weeks, the lofty dream of slinging s-expressions during my day job
has finally come true. (Apprentices are compensated at a flat rate of
$0.002 per parenthesis). After spending three months learning rules
and practices for writing clean object-oriented code, I'm now
<a href="https://leanpub.com/fp-oo">mapping them to functional programming</a>.
Over the next few posts, I'll try translating some of the guidelines
for clean code to Clojure. Like <a href="https://chronicle.com/article/50-Years-of-Stupid-Grammar/25497">any style guide</a>, there will be room
for opinion, so don't hesitate to leave comments or offer suggestions.</p>

<p><a href="https://chronicle.com/article/50-Years-of-Stupid-Grammar/25497"><em>Clean Code</em></a> is worth the cover price for Chapter 2 alone. Its
advice is simple: use meaningful, clear names that reveal intent.
This rule probably seems obvious, but the value is in its side
effects. Taking the time to scrutinize every name requires
the sort of mindfulness and thought that produces clean code. In
addition to Uncle Bob's general guidelines for good names, here are a
few Clojure-specific rules on naming.</p>

<h2>Verbs rule</h2>

<p>Clojure's categorical imperative: act in the <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">Kingdom of
Verbs</a>.
Functions do things, and their names should describe the things they
do. This is usually an easy rule to follow, but functions that build
or return data structures can be tricky. <code>Make-user-map</code> is better
than <code>user-data</code>. <code>Render-footer</code> is better than <code>footer</code> alone.</p>

<h2>But nouns are useful</h2>

<p>Verbs are great, but they're even greater when they have objects. A name like
<code>remove-temporary-files</code> is much clearer than <code>clean-up</code>.</p>

<p>Nouns are also useful inside functions. I find my tolerance for
repetition far lower in Clojure than in other languages: if I use an expression more
than once, I'll almost always put it in a <code>let</code> binding and give it a
name. Inside functions that compose multiple transformations on some
data structure, extracting intermediate steps into values in a <code>let</code>
binding can be very helpful.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">make-french-wombat-pairs</span> <span class="p">[</span><span class="nv">crazy-nested-map</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">interesting-pairs</span>  <span class="p">(</span><span class="nf">extract-interesting-pairs</span> <span class="nv">crazy-nested-map</span><span class="p">)</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="nv">pairs-with-wombats</span> <span class="p">(</span><span class="nb">map </span><span class="nv">add-wombat</span> <span class="nv">interesting-pairs</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">in-french</span>          <span class="p">(</span><span class="nb">map </span><span class="nv">to-french</span> <span class="nv">pairs-with-wombats</span><span class="p">)]</span>
</span><span class='line'><span class="nv">in-french</span><span class="p">))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Good nouns are also helpful when destructuring
values, which is awesomely useful but sometimes hard to read. Prefer
putting them in <code>let</code> bindings to cramming them in the argument list,
except for very simple cases.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">print-summary</span> <span class="p">[</span><span class="nv">statistics</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[{</span><span class="nv">raw-data</span> <span class="ss">:data</span> <span class="p">{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">mean</span> <span class="nv">variance</span> <span class="nv">r-squared</span><span class="p">]}</span> <span class="ss">:summary</span><span class="p">}</span> <span class="nv">statistics</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span><span class="p">(</span><span class="nb">println </span><span class="s">&quot;Mean: &quot;</span> <span class="nv">mean</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">println </span><span class="s">&quot;Variance: &quot;</span> <span class="nv">variance</span>
</span><span class='line'><span class="p">(</span><span class="nb">println </span><span class="s">&quot;R-Squared: &quot;</span> <span class="nv">r-squared</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nb">println </span><span class="s">&quot;Sample size: &quot;</span> <span class="p">(</span><span class="nb">count </span><span class="nv">raw-data</span><span class="p">)))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">arctic-circle?</span> <span class="p">[[</span><span class="nv">latitude</span> <span class="nv">_</span><span class="p">]]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">&gt; </span><span class="nv">latitude</span> <span class="mi">65</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>And okay fine, also adjectives</h2>

<p>The one first-class exception to verbs everywhere is adjectives for
predicates (functions that return <code>true</code> or <code>false</code>, like <code>odd?</code> and
<code>seq?</code>). These should always end in question marks and always return
either <code>true</code> or <code>false</code>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">all-wombats?</span> <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">every? </span><span class="p">(</span><span class="nf">wombat?</span> <span class="nv">coll</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Use the best name...</h2>

<p>Clojure has a large set of core functions, and sometimes the clearest
name for a function will collide with one of them. Use it anyways!
This is why namespaces are useful. Similarly, don't worry if the best
name is a long one--it's easy to rebind it to a new name when required.</p>

<h2>...But don't mislead</h2>

<p>That said, make sure it really is the best name. Long names often
indicate functions that can be split: <code>invert-and-multiply</code> and
<code>find-and-replace</code> should probably be split in two. (Hint: <code>and</code> is a
great clue). If a function's name collides with a core function or
incorporates a common name, it should act the same way: if <code>table-map</code>
doesn't apply a function to every cell in a table, it has the wrong name.</p>

<h2>Use idiomatic vocabulary</h2>

<p>The <a href="https://github.com/bbatsov/clojure-style-guide">Clojure style guide</a>, <a href="http://clojuredocs.org/">Clojuredocs examples</a> and Clojure's own
<a href="http://dev.clojure.org/display/community/Library+Coding+Standards">library coding
standards</a>
are good resources for picking up common Clojure idioms and
vocabulary. Here are a few naming conventions.</p>

<p>In macros, <code>expr</code> is usually used for a single expression and <code>body</code>
for a longer form.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nb">when </span><span class="p">[</span><span class="nv">expr</span> <span class="o">&amp;</span><span class="nv">amp</span><span class="c1">; body]</span>
</span><span class='line'>  <span class="o">`</span><span class="p">(</span><span class="k">if </span><span class="o">~</span><span class="nv">expr</span> <span class="p">(</span><span class="k">do </span><span class="o">~@</span><span class="nv">body</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>"Collection" is often shortened to <code>coll</code>:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">remove-wombats</span> <span class="p">[</span><span class="nv">coll</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">filter </span><span class="nv">wombat?</span> <span class="nv">coll</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Bundling up extra arguments is almost always done with <code>&amp; more</code>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">shout-all-args</span> <span class="p">[</span><span class="o">&amp;</span><span class="nv">amp</span><span class="c1">; more]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nv">arg</span> <span class="nv">more</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">upcase</span> <span class="nv">arg</span><span class="p">)</span> <span class="s">&quot;!&quot;</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Like in middle school math, <code>n</code> is usually an integer, <code>x</code> and <code>y</code> are
default numerical inputs, and <code>f</code>, <code>g</code>, and <code>h</code> are often functions.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">local-max?</span> <span class="p">[</span><span class="nv">f</span> <span class="p">[</span><span class="nv">x</span> <span class="nv">y</span><span class="p">]]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">f</span><span class="o">&#39;</span>  <span class="p">(</span><span class="nf">derivative</span> <span class="nv">f</span><span class="p">)</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="nv">f</span><span class="o">&#39;&#39;</span> <span class="p">(</span><span class="nf">derivative</span> <span class="p">(</span><span class="nf">derivative</span> <span class="nv">f</span><span class="p">))]</span>
</span><span class='line'><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">; 0 (f&#39;&#39; x)) (= 0 (f&#39; x))))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Dynamic vars wear <code>*earmuffs*</code>. Try not to use them.</p>

<p>Simple format transformations often use an arrow, e.g.: <code>cljs-&gt;clj</code>,
<code>html-&gt;hiccup</code>, <code>hex-&gt;bytes</code>.</p>

<h2>Make side effects explicit</h2>

<p>Clojure does a great job separating <a href="http://www.infoq.com/presentations/Value-Identity-State-Rich-Hickey">value, state, and
  identity</a>.
  Clojure programmers should, too. If a function changes state or has
  side effects, its name should reflect it. Functions that mutate
  state like <code>swap!</code> and <code>reset!</code> end with a bang. Side effects hiding
  elsewhere should also be explicit: if <code>format-page</code> saves a file to
  disk, it should be <code>format-and-save-page</code> (or even better, two
  separate functions).</p>

<p><strong>UPDATE</strong>: See also the <a href="https://github.com/bbatsov/clojure-style-guide">Clojure Style Guide</a>, a concise, comprehensive community-driven document with many more guidelines on clean Clojure.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Specljs Leiningen template]]></title>
    <link href="http://ecmendenhall.github.io/blog/blog/2013/08/04/specljs-leiningen-template/"/>
    <updated>2013-08-04T14:19:00-05:00</updated>
    <id>http://ecmendenhall.github.io/blog/blog/2013/08/04/specljs-leiningen-template</id>
    <content type="html"><![CDATA[<p>I'm very fond of <a href="http://speclj.com/">Speclj</a>, the simple, flexible Clojure spec runner we
use at 8th Light. Speclj now has a ClojureScript
<a href="https://clojars.org/specljs">counterpart</a>, but like many things
ClojureScript, it requires some classpath juggling and configuration
to get everything working nicely. To save my future self the hassle, I
put together a basic project template with Speclj and Specljs tests
and autorunners both preconfigured.</p>

<p>If you're using Leiningen 2, it's as easy as:</p>

<pre><code>$ lein new specljs &lt;your project name&gt;
</code></pre>

<p>Leiningen will download the template from Clojars automatically.</p>

<p>To start the Speclj autorunner from inside the project directory:</p>

<pre><code>$ lein spec -a
</code></pre>

<p>Specljs tests are configured to run whenever the ClojureScript
compiles. To watch for changes, rebuild and run tests automatically,
start the cljsbuild auto-compiler:</p>

<pre><code>$ lein cljsbuild auto
</code></pre>

<p>To run specljs tests once:</p>

<pre><code>$ lein cljsbuild test
</code></pre>

<p>If you're using pre-2.0 Leiningen, you can find the template on
<a href="https://clojars.org/specljs/lein-template">Clojars</a> and the source on <a href="https://github.com/ecmendenhall/specljs-template">GitHub</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Prime factorization with core.logic]]></title>
    <link href="http://ecmendenhall.github.io/blog/blog/2013/07/15/prime-factorization-with-core-dot-logic/"/>
    <updated>2013-07-15T00:31:00-05:00</updated>
    <id>http://ecmendenhall.github.io/blog/blog/2013/07/15/prime-factorization-with-core-dot-logic</id>
    <content type="html"><![CDATA[<p>It's time for my first <a href="http://blog.8thlight.com/micah-martin/2013/05/28/performing-code-katas.html">code
kata</a>,
and on Colin's suggestion, I'm starting with a classic: <a href="http://butunclebob.com/ArticleS.UncleBob.ThePrimeFactorsKata">prime
factorization</a>.
The problem description is simple: write a function that takes an
integer n and returns a list of its prime factors in ascending order.
That leaves lots of room for creativity, and in my few months at 8th
Light, I've seen several interesting solutions, including <a href="https://github.com/marosluuce/objective-c-PrimeFactors">Objective-C</a>
and
<a href="http://telladifferentstory.tumblr.com/post/49745640314/pattern-matching-re-visited-with-the-prime-factors-kata">Erlang</a>.
I've been meaning to learn Clojure's <code>core.logic</code> library for a while,
so I decided to come up with a logic programming solution.</p>

<p>If you haven't yet checked out <code>core.logic</code>, there are a growing
number of resources on the web. To get up to speed, I worked through David Nolen's <a href="https://github.com/swannodette/logic-tutorial">logic tutorial</a>, the <a href="http://objectcommando.com/blog/2011/11/04/the-magical-island-of-kanren-core-logic-intro-part-1/">Magical Island of Kanren</a>, the
<a href="https://github.com/clojure/core.logic/wiki/A-Core.logic-Primer">core.logic
Primer</a>,
and a few chapters of <a href="http://www.amazon.com/The-Reasoned-Schemer-Daniel-Friedman/dp/0262562146">The Reasoned
Schemer</a>.
Hopefully, following along with my test cases will explain the subset
of logic functions in my solution.</p>

<p>I'll start with a basic <a href="https://github.com/slagyr/speclj">speclj</a>
test setup:
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>        <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>For the production code, I'll start with <code>core.logic</code> and three functions from the <a href="https://github.com/clojure/core.logic/wiki/Features#clpfd">finite domain</a> namespace.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>On to the tests! The declarative aspect of logic programming feels
well-suited to a mathy problem like this. Instead of describing <em>how</em> to
factorize, I'll write a few definitions and let the logic engine
handle the rest. The strategy I have in mind is the same simple one I learned in
8th grade algebra: start with a composite integer, and <a href="https://en.wikipedia.org/wiki/Prime_factorization#Prime_decomposition">decompose it</a>
into a factor tree whose leaves are prime factors.</p>

<p>To start, I'll define "factor pairs": a vector of two integers that
multiply to another. So, <code>[2 3]</code>  is a factor pair of 6, <code>[1 23]</code> a
factor pair of 23. Here's the most general test I came up with:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>        <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span><span class="nv">amp</span><span class="c1">; args] `(it ~@args))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">([</span><span class="nv">_0</span> <span class="nv">_1</span><span class="p">])</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>There's a lot of syntax right off the bat, but this test isn't as
confusing as it might look. So far, I've found it easiest to understand logic programming as
describing a set of constraints on a solution. This test describes the
first constraint: factor pairs are vectors of two elements.</p>

<p>Here, <code>_0</code> and <code>_1</code> represent <em>reified</em>, <em>unbound</em> logic variables: symbolic
representations of logic variables that can take on any value. (The
numbers at the end indicate that they're two different variables: <code>_0</code>
and <code>_1</code> can take on different values). So this
test simply describes the most general constraint: the <code>factor-pairs</code>
function should take something as an argument and return a list of
vectors of two things--any two things!.</p>

<p>Here's a function that does just that:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>           <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The <code>run*</code> function is the, uh, <em>core</em> of <code>core.logic</code>, used to set up
problems for the logic engine to solve. It returns a list of all the
solutions that match the constraints defined inside. The <code>fresh</code> form
inside of <code>run*</code> is
analogous to <code>let</code>: a way to declare local logic variables. The first
two lines say "Find all
the solutions where pair, factor1, and factor2 meet these
constraints," and the third describes the only constraint: "A pair is a
vector of two elements, factor1 and factor2".</p>

<p>Note that I'm ignoring the <code>number</code> argument! At this point
<code>(factor-pairs 81)</code>, <code>(factor-pairs 72)</code>, and <code>(factor-pairs 23)</code> all
return the same result. For now, calling this function <code>factor-pairs</code>
is a little misleading, since it returns the equivalent of all
possible pairs of two things. But now that the tests pass, we can add
another constraint:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>        <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span><span class="nv">amp</span><span class="c1">; args] `(it ~@args))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">;= % high)) pair)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
Here, I'll describe the next constraint: factor pairs should only be
defined between 2 and n. (Yes, a pair like <code>[1 23]</code> is technically a
pair of factors, but it's not very useful for my prime factorization purposes).</p>

<p>I may be open to a little <a href="http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd">TDD legal trouble</a>
with this test update, but I've added a couple helper functions to
keep the tests as declarative as possible. <code>Should-all</code> asserts that a
predicate matches for every element in a collection. <code>In-interval?</code>
tests whether a pair is in the range <code>low</code> to <code>high</code>, inclusive.
Hopefully, <code>Two-elements?</code> explains itself. Since <code>factor-pairs</code> will
now return a list with many elements, I've generalized the original test.</p>

<p>It only takes one line to add the extra constraint:
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>           <span class="p">(</span><span class="nf">in</span> <span class="nv">factor1</span> <span class="nv">factor2</span> <span class="p">(</span><span class="nf">interval</span> <span class="mi">2</span> <span class="nv">number</span><span class="p">))</span>
</span><span class='line'>           <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The new line declares that <code>factor1</code> and <code>factor2</code> must both be in the
finite interval 2-<code>number</code>. <code>Factor-pairs</code> is still something of a
misnomer: it now returns the Cartesian product of all numbers
2-<code>number</code>. But it's a step closer. I'll add one more constraint:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>        <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span><span class="nv">amp</span><span class="c1">; args] `(it ~@args))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">;= % high)) pair)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Factor pairs contain two elements between 2 and n that equal n when
multiplied. That's a complete definition of a factor pair, and adding
the third constraint completes the function:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>           <span class="p">(</span><span class="nf">in</span> <span class="nv">factor1</span> <span class="nv">factor2</span> <span class="p">(</span><span class="nf">interval</span> <span class="mi">2</span> <span class="nv">number</span><span class="p">))</span>
</span><span class='line'>           <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nb">= </span><span class="nv">number</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">)))</span>
</span><span class='line'>           <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Here, <code>eq</code> converts an arithmetic expression into a constraint, as
long as the logic variables are defined over a finite domain. So the
final constraint simply says <code>number</code> must equal <code>factor1</code> times
<code>factor2</code>. If you're not convinced by the tests, try it in a REPL:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)</span>
</span><span class='line'><span class="p">([</span><span class="mi">3</span> <span class="mi">27</span><span class="p">]</span> <span class="p">[</span><span class="mi">9</span> <span class="mi">9</span><span class="p">]</span> <span class="p">[</span><span class="mi">27</span> <span class="mi">3</span><span class="p">])</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;user=&gt;</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">148</span><span class="p">)</span>
</span><span class='line'><span class="p">([</span><span class="mi">2</span> <span class="mi">74</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">37</span><span class="p">]</span> <span class="p">[</span><span class="mi">37</span> <span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="mi">74</span> <span class="mi">2</span><span class="p">])</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;user=&gt;</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">)</span>
</span><span class='line'><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>There are some properties here that I'll use to my advantage. First,
by default, factor pairs are ordered by the first factor, ascending.
Second, I've already created an implicit definition of primes: numbers
that return an empty list of factor pairs. I'll add it as a test for
clarity:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>        <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span><span class="nv">amp</span><span class="c1">; args] `(it ~@args))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">;= % high)) pair)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Prime numbers&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;have no factor pairs&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Now I'll move on to decomposition. If you've watched a prime factors
kata before, you've probably seen a few standard tests: start by
testing 1, then 2, then 3, and then composites. Here's where something
similar comes in:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>        <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span><span class="nv">amp</span><span class="c1">; args] `(it ~@args))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">;= % high)) pair)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Prime numbers&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;have no factor pairs&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Decomposition&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 1 into itself&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">1</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Of course, it's easy to pass this one:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>           <span class="p">(</span><span class="nf">in</span> <span class="nv">factor1</span> <span class="nv">factor2</span> <span class="p">(</span><span class="nf">interval</span> <span class="mi">2</span> <span class="nv">number</span><span class="p">))</span>
</span><span class='line'>           <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nb">= </span><span class="nv">number</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">)))</span>
</span><span class='line'>           <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">decompose</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>I'll make it a little harder with the next bit of the definition.
Primes should decompose into themselves:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>        <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span><span class="nv">amp</span><span class="c1">; args] `(it ~@args))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">;= % high)) pair)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Prime numbers&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;have no factor pairs&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Decomposition&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 1 into itself&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">1</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes primes into themselves&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">3</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">17</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">23</span><span class="p">)))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>I'll get back to passing with a small tweak. Instead of returning
<code>'(1)</code>, <code>decompose</code> should check if a number has any
factor pairs. If not, return the number.
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>           <span class="p">(</span><span class="nf">in</span> <span class="nv">factor1</span> <span class="nv">factor2</span> <span class="p">(</span><span class="nf">interval</span> <span class="mi">2</span> <span class="nv">number</span><span class="p">))</span>
</span><span class='line'>           <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nb">= </span><span class="nv">number</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">)))</span>
</span><span class='line'>           <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">decompose</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">factorpair</span> <span class="p">(</span><span class="nb">first </span><span class="p">(</span><span class="nf">factor-pairs</span> <span class="nv">number</span><span class="p">))]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty?</span> <span class="nv">factorpair</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">number</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>That's the easy part, but what about composites? Well, two times a
prime should certainly decompose to 2 and the prime:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'>      <span class="nv">&lt;br/&gt;</span>
</span><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>        <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span><span class="nv">amp</span><span class="c1">; args] `(it ~@args))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">;= % high)) pair)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Prime numbers&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;have no factor pairs&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Decomposition&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 1 into itself&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">1</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes primes into themselves&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">3</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">17</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">23</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 2 * a prime into 2 and itself&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">4</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><code>Decompose</code> already includes the base case at the bottom of of the
prime factor tree. If I feed it a number that's not prime, it should
decompose its factors until it runs into a prime. Concatenating the
results should return a nice list of prime factors:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.logic.fd</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">in</span> <span class="nv">interval</span> <span class="nv">eq</span><span class="p">]]))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">factor-pairs</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">run*</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>    <span class="p">(</span><span class="nf">fresh</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]</span>
</span><span class='line'>           <span class="p">(</span><span class="nf">in</span> <span class="nv">factor1</span> <span class="nv">factor2</span> <span class="p">(</span><span class="nf">interval</span> <span class="mi">2</span> <span class="nv">number</span><span class="p">))</span>
</span><span class='line'>           <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nb">= </span><span class="nv">number</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">)))</span>
</span><span class='line'>           <span class="p">(</span><span class="nb">== </span><span class="nv">pair</span> <span class="p">[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">decompose</span> <span class="p">[</span><span class="nv">number</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">factorpair</span> <span class="p">(</span><span class="nb">first </span><span class="p">(</span><span class="nf">factor-pairs</span> <span class="nv">number</span><span class="p">))]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty?</span> <span class="nv">factorpair</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">number</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">concat </span><span class="p">(</span><span class="nf">decompose</span> <span class="p">(</span><span class="nb">first </span><span class="nv">factorpair</span><span class="p">))</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">decompose</span> <span class="p">(</span><span class="nb">second </span><span class="nv">factorpair</span><span class="p">))))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And that's it! Here's a last set of test cases to confirm that it
works:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core_spec.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='clj'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">prime-factors.core-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>        <span class="p">[</span><span class="nv">prime-factors.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defmacro </span><span class="nv">they</span> <span class="p">[</span><span class="o">&amp;</span><span class="nv">amp</span><span class="c1">; args] `(it ~@args))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">should-all</span> <span class="p">[</span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">should</span> <span class="p">(</span><span class="nb">every? </span><span class="nv">predicate</span> <span class="nv">collection</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">in-interval?</span> <span class="p">[</span><span class="nv">low</span> <span class="nv">high</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">pair</span><span class="p">]</span> <span class="p">(</span><span class="nb">every? </span><span class="o">#</span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">%</span> <span class="nv">low</span><span class="p">)</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">lt</span><span class="c1">;= % high)) pair)))&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">two-elements?</span> <span class="p">[</span><span class="nv">pair</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">count </span><span class="nv">pair</span><span class="p">)))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-to?</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">]]</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="nv">factor1</span> <span class="nv">factor2</span><span class="p">))))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Factor pairs of n&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;contain two elements&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="nv">two-elements?</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;are defined between 2 and n&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">in-interval?</span> <span class="mi">2</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;equal n when multiplied&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should-all</span> <span class="p">(</span><span class="nf">multiply-to?</span> <span class="mi">81</span><span class="p">)</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">81</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Prime numbers&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">they</span> <span class="s">&quot;have no factor pairs&quot;</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="nf">factor-pairs</span> <span class="mi">23</span><span class="p">))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;Decomposition&quot;</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>      <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 1 into itself&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">1</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes primes into themselves&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">3</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">17</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">23</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes 2 * a prime into 2 and itself&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">4</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;decomposes a composite into its prime factorization&quot;</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">8</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">30</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">11</span> <span class="mi">11</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="mi">242</span><span class="p">))</span>
</span><span class='line'>          <span class="p">(</span><span class="nf">should=</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">2</span> <span class="mi">5</span> <span class="mi">11</span> <span class="mi">23</span><span class="p">)</span> <span class="p">(</span><span class="nf">decompose</span> <span class="p">(</span><span class="nb">* </span><span class="mi">23</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">11</span><span class="p">)))))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>This isn't the fastest way to find prime factors, but it's no worse
than the typical trial division solution to the prime factors kata.
Using <code>core.logic</code> to declare definitions and constraints on the
solution feels uniquely concise, expressive, and clear, and the
exercise helped me get a more concrete handle on logic programming.
You can find the code from this post (and a few earlier iterations) <a href="https://gist.github.com/ecmendenhall/5970568">as
a Gist here</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Clojure namespaces for Python programmers]]></title>
    <link href="http://ecmendenhall.github.io/blog/blog/2013/07/14/clojure-namespaces-for-python-programmers/"/>
    <updated>2013-07-14T22:28:00-05:00</updated>
    <id>http://ecmendenhall.github.io/blog/blog/2013/07/14/clojure-namespaces-for-python-programmers</id>
    <content type="html"><![CDATA[<p>My mentor <a href="https://twitter.com/trptcolin">Colin</a> wrote one of the most
popular posts on the <a href="http://blog.8thlight.com/">8th Light blog</a>, on
the somewhat complex process of <a href="http://blog.8thlight.com/colin-jones/2010/12/05/clojure-libs-and-namespaces-require-use-import-and-ns.html">requiring Clojure
libs</a>.
It's not a stretch to give it some of the credit for my interest in
Clojure: I came close to giving up in frustration the first time I
tried to import a library in a Clojure REPL. It was <a href="http://xkcd.com/353/">so easy in
Python</a>, and there I was, suddenly dealing with
macros, keywords, quotes, and--heaven forfend!--all those parentheses.</p>

<p>For all the details on namespaces, <code>require</code>, and the <code>ns</code> macro, see
<a href="http://blog.8thlight.com/colin-jones/2010/12/05/clojure-libs-and-namespaces-require-use-import-and-ns.html">Colin's
post</a>,
which is still the authoritative source. But if you're a Python
programmer looking for a quick reference, here's the Python-Clojure
Rosetta stone I went looking for the first time I deadpanned into my
Clojure REPL.</p>

<h2>Import a library</h2>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">library</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">library</span><span class="o">.</span><span class="n">dostuff</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="nv">library</span><span class="p">))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">library/dostuff</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>REPL </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">library</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">In</span>  <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">library</span><span class="o">.</span><span class="n">dostuff</span><span class="p">()</span>
</span><span class='line'><span class="s">&quot;did stuff!&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;library</span><span class="p">)</span>
</span><span class='line'><span class="nv">nil&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;user=&gt;</span> <span class="p">(</span><span class="nf">library/dostuff</span><span class="p">)</span>
</span><span class='line'><span class="s">&quot;did stuff!&quot;</span>
</span><span class='line'><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Import everything without qualification</h2>

<p>(Note: This practice is usually as ill-advised in Clojure as it is in Python!)
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="o">*&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">dostuff</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">dostuff</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>REPL </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="o">*&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">In</span>  <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">dostuff</span><span class="p">()</span>
</span><span class='line'><span class="s">&quot;did stuff!&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</span><span class='line'><span class="nv">nil&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;user=&gt;</span> <span class="p">(</span><span class="nf">dostuff</span><span class="p">)</span>
</span><span class='line'><span class="s">&quot;did stuff!&quot;</span>
</span><span class='line'><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Import specific functions</h2>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">dostuff</span><span class="p">,</span> <span class="n">returnthings</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">dostuff</span><span class="p">()</span>
</span><span class='line'><span class="n">returnthings</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">dostuff</span> <span class="nv">returnthings</span><span class="p">]]))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">dostuff</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nf">returnthings</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>REPL </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">dostuff</span><span class="p">,</span> <span class="n">returnthings</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">In</span>  <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">dostuff</span><span class="p">()</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">In</span>  <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">returnthings</span><span class="p">()</span>
</span><span class='line'><span class="n">Out</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">{</span> <span class="s">&quot;foo&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">dostuff</span> <span class="nv">returnthings</span><span class="p">]])</span>
</span><span class='line'><span class="nv">nil&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;user=&gt;</span> <span class="p">(</span><span class="nf">dostuff</span><span class="p">)</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span><span class='line'><span class="nv">nil&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;user=&gt;</span> <span class="p">(</span><span class="nf">returnthings</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span> <span class="ss">:foo</span> <span class="mi">1</span> <span class="ss">:bar</span> <span class="mi">2</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Import and rename a library</h2>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">library</span> <span class="kn">as</span> <span class="nn">lib</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">lib</span><span class="o">.</span><span class="n">dostuff</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">library</span> <span class="ss">:as</span> <span class="nv">lib</span><span class="p">]))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">lib/dostuff</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>REPL </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">In</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">library</span> <span class="kn">as</span> <span class="nn">lib</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">In</span>  <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">lib</span><span class="o">.</span><span class="n">dostuff</span><span class="p">()</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">library</span> <span class="ss">:as</span> <span class="nv">lib</span><span class="p">])</span>
</span><span class='line'><span class="nv">nil&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;user=&gt;</span> <span class="p">(</span><span class="nf">lib/dostuff</span><span class="p">)</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span><span class='line'><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Import and rename a function</h2>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">dostuff</span> <span class="k">as</span> <span class="n">ds</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">ds</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">dostuff</span><span class="p">]</span> <span class="ss">:rename</span> <span class="p">{</span><span class="nv">dostuff</span> <span class="nv">ds</span><span class="p">}]))</span><span class="nv">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span><span class="p">(</span><span class="nf">ds</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>REPL </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">dostuff</span> <span class="k">as</span> <span class="n">ds</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">ds</span><span class="p">()</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">dostuff</span><span class="p">]</span> <span class="ss">:rename</span> <span class="p">{</span><span class="nv">dostuff</span> <span class="nv">ds</span><span class="p">}])</span>
</span><span class='line'><span class="nv">nil&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;user=&gt;</span> <span class="p">(</span><span class="nf">ds</span><span class="p">)</span>
</span><span class='line'><span class="s">&quot;did stuff&quot;</span>
</span><span class='line'><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>All together, now!</h2>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>File </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">onelibrary</span><span class="o">,</span> <span class="nn">anotherlibrary</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">onemorelibrary</span> <span class="kn">as</span> <span class="nn">oml</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">returnthings</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">library</span> <span class="kn">import</span> <span class="n">dostuff</span> <span class="k">as</span> <span class="n">ds</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">yourproject.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">onelibrary&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;pre&gt;&lt;code&gt;</span>         <span class="nv">anotherlibrary</span>
</span><span class='line'>         <span class="p">[</span><span class="nv">onemorelibrary</span> <span class="ss">:as</span> <span class="nv">oml</span><span class="p">]</span>
</span><span class='line'>         <span class="p">[</span><span class="nv">library</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">dostuff</span> <span class="nv">returnthings</span><span class="p">]</span>
</span><span class='line'>                  <span class="ss">:rename</span> <span class="p">{</span><span class="nv">dostuff</span> <span class="nv">ds</span><span class="p">}]]))</span>
</span><span class='line'><span class="nv">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
</feed>
